<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.6">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.6',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="All-trade Jack, loves full-stack">
<meta property="og:type" content="website">
<meta property="og:title" content="CMK">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="CMK">
<meta property="og:description" content="All-trade Jack, loves full-stack">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CMK">
<meta name="twitter:description" content="All-trade Jack, loves full-stack">






  <link rel="canonical" href="http://yoursite.com/page/5/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>CMK</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116541729-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116541729-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CMK</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Let's create something!</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
</li>

      

      
    </ul>
  

  
    

    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    

  


  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/Event-Emitter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/01/Event-Emitter/" itemprop="url">Event Emitter</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-01T20:21:44-07:00">2018-10-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="I-What-is-an-Event-Emitter"><a href="#I-What-is-an-Event-Emitter" class="headerlink" title="I. What is an Event Emitter?"></a>I. What is an Event Emitter?</h4><p>An <code>event emitter</code> is a <strong>utility object</strong>, which can be used to emit event, which can be subscribed by as many functions as we can. </p>
<ol>
<li><p>It is an event manager, manages differents event and its subscribers.</p>
</li>
<li><p>Also, we can see it as the <code>Redux</code>, which also dispatches(emits) actions, and handled by its reducers.</p>
</li>
<li>It widely used at Node.js ( asynchronous event-driven architecture)<ul>
<li>certain kind of objects call emitters periodically to emit events that cause listener objects to be called.</li>
<li>when a request comes requesting some resource, Node.js will register the subscriber: <code>responseToThisRequest()</code> on event: <code>thisTypeDataDone</code>. When data is obtained, will call <code>emitter.emit( thisTypeDataDone )</code>, to call the <code>responseToThisRequest()</code> corresponding all the requests.</li>
</ul>
</li>
</ol>
<h4 id="II-Why-and-when-do-we-need-it"><a href="#II-Why-and-when-do-we-need-it" class="headerlink" title="II. Why and when do we need it?"></a>II. Why and when do we need it?</h4><blockquote>
<p>Whenever it makes sense for code to SUBSCRIBE to something rather than get a callback from something</p>
<p><a href="https://stackoverflow.com/questions/38881170/when-should-i-use-eventemitter" target="_blank" rel="noopener">https://stackoverflow.com/questions/38881170/when-should-i-use-eventemitter</a></p>
</blockquote>
<p>If when a certain event happens, we have to deal many type of manipulation for that event‚Äôs result, then it is better to use the event emitter pattern. </p>
<p>Instead put all functions inside an event callback, we subscribe all the function to that event, when the event happens, we emit the event!</p>
<h4 id="III-How-to-use-it"><a href="#III-How-to-use-it" class="headerlink" title="III. How to use it?"></a>III. How to use it?</h4><p><strong>[Good Link]:</strong> <a href="https://netbasal.com/javascript-the-magic-behind-event-emitter-cce3abcbcef9" target="_blank" rel="noopener">https://netbasal.com/javascript-the-magic-behind-event-emitter-cce3abcbcef9</a></p>
<p><strong>[Note]:  when pass in the callback function, we use arrow function, which already bind ‚Äòthis‚Äô to the function, so that when the function be called, it knows what value it will update</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">let</span> input = <span class="built_in">document</span>.querySelector(<span class="string">'input[type="text"]'</span>);</span><br><span class="line"><span class="keyword">let</span> button = <span class="built_in">document</span>.querySelector(<span class="string">'button'</span>);</span><br><span class="line"><span class="keyword">let</span> h1 = <span class="built_in">document</span>.querySelector(<span class="string">'h1'</span>);</span><br><span class="line"></span><br><span class="line">button.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">  emitter.emit(<span class="string">'event:name-changed'</span>, &#123;<span class="attr">name</span>: input.value&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> emitter = <span class="keyword">new</span> EventEmitter();</span><br><span class="line">emitter.subscribe(<span class="string">'event:name-changed'</span>, data =&gt; &#123;</span><br><span class="line">  h1.innerHTML = <span class="string">`Your name is: <span class="subst">$&#123;data.name&#125;</span>`</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol>
<li><p>create an emitter util object</p>
</li>
<li><p>subscribe the desired callback function, using <code>emitter.subscribe(event, function.bind(this))</code></p>
</li>
<li><p>call <code>emitter.emit()</code> when the event happen</p>
</li>
</ol>
<h4 id="IV-Write-one"><a href="#IV-Write-one" class="headerlink" title="IV. Write one!"></a>IV. Write one!</h4><ol>
<li><strong><u>object:</u></strong> we need an object (utility object)</li>
<li><u><strong>data structure:</strong></u> inside it, we need a data structure to store the <code>event</code> and its <code>subscribers</code>(callbacks)</li>
<li><strong><u>methods:</u></strong>  all the methods<ul>
<li><code>subscribe(event, callback)</code>: we need the return value to be an <code>unsubscribe()</code>, so we won‚Äôt result in the memory leak!</li>
<li><code>emit()</code></li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.events = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  on(event, listener) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.events[event] !== <span class="string">'object'</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.events[event] = [];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.events[event].push(listener);</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.removeListener(event, listener);</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  removeListener(event, listener) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.events[event] === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> idx = <span class="keyword">this</span>.events[event].indexOf(listener);</span><br><span class="line">        <span class="keyword">if</span> (idx &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.events[event].splice(idx, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  emit(event, ...args) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.events[event] === <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.events[event].forEach(</span><br><span class="line">        listener =&gt; &#123;<span class="keyword">if</span>(<span class="keyword">typeof</span> listener === <span class="string">'function'</span>) listener.apply(<span class="literal">null</span>, args)&#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// register a wrapper function containing the listener on this event,</span></span><br><span class="line">  <span class="comment">// when get executed, </span></span><br><span class="line">  <span class="comment">//   - first remove it on this event;</span></span><br><span class="line">  <span class="comment">//   - then execute real listener</span></span><br><span class="line">  once(event, listener) &#123;</span><br><span class="line">    <span class="keyword">const</span> remove = <span class="keyword">this</span>.on(event, (...args) =&gt; &#123;</span><br><span class="line">        remove();</span><br><span class="line">        listener.apply(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> emitter = <span class="keyword">new</span> EventEmitter()</span><br><span class="line"><span class="comment">// Test 1: invalid callback function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Test 1: Nothing should be print out"</span>)</span><br><span class="line">emitter.on(<span class="string">"a"</span>, <span class="number">1</span>);</span><br><span class="line">emitter.emit(<span class="string">"a"</span>);</span><br><span class="line"><span class="built_in">console</span>.log()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 2: add mutilple callback function to an event</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Test 2: callback 1, 2, 3"</span>)</span><br><span class="line">emitter.on(<span class="string">"b"</span>, ()=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"event b callback 1"</span>)&#125;);</span><br><span class="line">emitter.on(<span class="string">"b"</span>, ()=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"event b callback 2"</span>)&#125;);</span><br><span class="line"><span class="keyword">let</span> off1 = emitter.on(<span class="string">"b"</span>, ()=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"event b callback 3"</span>)&#125;);</span><br><span class="line">emitter.emit(<span class="string">"b"</span>);</span><br><span class="line"><span class="built_in">console</span>.log()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 3: unsubscribe one callback from an event queue</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Test 3: callback 1, 2"</span>)</span><br><span class="line">off1();</span><br><span class="line">emitter.emit(<span class="string">"b"</span>); </span><br><span class="line"><span class="built_in">console</span>.log()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 4: subscribe other event &amp; callbacks at the same time</span></span><br><span class="line"><span class="keyword">let</span> data = &#123;<span class="attr">digit</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Test 4:  digit should be 11 &amp; 14 "</span>)</span><br><span class="line">emitter.on(<span class="string">"c"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123; data.digit+=<span class="number">1</span> &#125;);</span><br><span class="line">emitter.on(<span class="string">"c"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123; data.digit+=<span class="number">2</span> &#125;);</span><br><span class="line">emitter.on(<span class="string">"d"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123; data.digit+=<span class="number">3</span> &#125;);;</span><br><span class="line"><span class="keyword">let</span> off2 = emitter.on(<span class="string">"d"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123; data.digit+=<span class="number">4</span> &#125;);</span><br><span class="line"></span><br><span class="line">emitter.emit(<span class="string">"c"</span>, data); </span><br><span class="line">emitter.emit(<span class="string">"d"</span>, data);  </span><br><span class="line"><span class="built_in">console</span>.log(data.digit)</span><br><span class="line">      </span><br><span class="line">off2()</span><br><span class="line">emitter.emit(<span class="string">"d"</span>, data);  </span><br><span class="line"><span class="built_in">console</span>.log(data.digit)</span><br><span class="line"><span class="built_in">console</span>.log()</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 5: subscribe other event &amp; callbacks</span></span><br><span class="line"><span class="keyword">let</span> data2 = &#123;<span class="attr">digit</span>: <span class="number">5</span>&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Test 5: digit should be 11"</span>)</span><br><span class="line">emitter.emit(<span class="string">"d"</span>, data2 ); </span><br><span class="line">emitter.emit(<span class="string">"c"</span>, data2 ); </span><br><span class="line"><span class="built_in">console</span>.log(data2.digit)   </span><br><span class="line"><span class="built_in">console</span>.log()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Test 6: test once</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Test 6: should only print once"</span>)</span><br><span class="line">emitter.once(<span class="string">"test 6"</span>, ()=&gt;&#123;<span class="built_in">console</span>.log(<span class="string">"should only print once"</span>)&#125; ); </span><br><span class="line">emitter.emit(<span class="string">"test 6"</span> ); </span><br><span class="line">emitter.emit(<span class="string">"test 6"</span> ); </span><br><span class="line">emitter.emit(<span class="string">"test 6"</span> ); </span><br><span class="line"><span class="built_in">console</span>.log()</span><br></pre></td></tr></table></figure>
<p><strong><em>FaceBook interview version</em></strong><br><a href="https://gist.github.com/kutyel/7d8f204a347840a6ee7220743957e504" target="_blank" rel="noopener">https://gist.github.com/kutyel/7d8f204a347840a6ee7220743957e504</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Create an event emitter that goes like this</span></span><br><span class="line"><span class="comment"> * emitter = new Emitter();</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Allows you to subscribe to some event</span></span><br><span class="line"><span class="comment"> * sub1 = emitter.subscribe('function_name', callback1);</span></span><br><span class="line"><span class="comment"> * (you can have multiple callbacks to the same event)</span></span><br><span class="line"><span class="comment"> * sub2 = emitter.subscribe('function_name', callback2);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can emit the event you want with this api</span></span><br><span class="line"><span class="comment"> * (you can receive 'n' number of arguments)</span></span><br><span class="line"><span class="comment"> * sub1.emit('function_name', foo, bar);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * And allows you to release the subscription like this</span></span><br><span class="line"><span class="comment"> * (but you should be able to still emit from sub2)</span></span><br><span class="line"><span class="comment"> * sub1.release();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// facebook.js</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Emitter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(events = &#123;&#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>.events = events</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  subscribe(name, cb) &#123;</span><br><span class="line">    (<span class="keyword">this</span>.events[name] || (<span class="keyword">this</span>.events[name] = [])).push(cb)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      release: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.events[name] &amp;&amp;</span><br><span class="line">        <span class="keyword">this</span>.events[name].splice(<span class="keyword">this</span>.events[name].indexOf(cb) &gt;&gt;&gt; <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  emit(name, ...args) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span>.events[name] || []).map(<span class="function"><span class="params">fn</span> =&gt;</span> fn(...args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Emitter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expect = <span class="built_in">require</span>(<span class="string">'expect'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Emitter = <span class="built_in">require</span>(<span class="string">'./facebook'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> test = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> Emitter()</span><br><span class="line"></span><br><span class="line">emitter.emit(<span class="string">'sum'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">expect(test).toBe(<span class="number">0</span>) <span class="comment">// should trigger nothing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sub1 = emitter.subscribe(<span class="string">'sum'</span>, num =&gt; (test = test + num))</span><br><span class="line"></span><br><span class="line">emitter.emit(<span class="string">'sum'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">expect(test).toBe(<span class="number">1</span>) <span class="comment">// should trigger 1 callback</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sub2 = emitter.subscribe(<span class="string">'sum'</span>, num =&gt; (test = test * num))</span><br><span class="line"></span><br><span class="line">emitter.emit(<span class="string">'sum'</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">expect(test).toBe(<span class="number">6</span>) <span class="comment">// should trigger 2 callbacks</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 2</span></span><br><span class="line"></span><br><span class="line">sub1.release()</span><br><span class="line"></span><br><span class="line">emitter.emit(<span class="string">'sum'</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">expect(test).toBe(<span class="number">18</span>) <span class="comment">// should trigger 1 callback</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Step 3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myEvent1 = emitter.subscribe(<span class="string">'myEvent'</span>, () =&gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> myEvent2 = emitter.subscribe(<span class="string">'myEvent'</span>, () =&gt; <span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> myEvent3 = emitter.subscribe(<span class="string">'myEvent'</span>, () =&gt; <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">const</span> result = emitter.emit(<span class="string">'myEvent'</span>)</span><br><span class="line"></span><br><span class="line">expect(result).toEqual([<span class="number">1</span>, <span class="number">2</span>, <span class="literal">true</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.info(<span class="string">'You passed the test!!! üëèüèº üëèüèº üëèüèº'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/20/CSS-element-positioning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/20/CSS-element-positioning/" itemprop="url">CSS: element positioning</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-20T11:46:43-07:00">2018-09-20</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="0-Credit-to"><a href="#0-Credit-to" class="headerlink" title="0. Credit to:"></a>0. Credit to:</h2><ol>
<li><p><a href="http://javascript.info/coordinates" target="_blank" rel="noopener">http://javascript.info/coordinates</a></p>
</li>
<li><p><a href="https://msdn.microsoft.com/en-us/library/hh781509(VS.85).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/hh781509(VS.85).aspx</a></p>
</li>
</ol>
<h2 id="I-mouse-event-positon"><a href="#I-mouse-event-positon" class="headerlink" title="I. mouse event positon"></a>I. <code>mouse event</code> positon</h2><ol>
<li><a href="https://www.w3schools.com/jsref/event_clientx.asp" target="_blank" rel="noopener">https://www.w3schools.com/jsref/event_clientx.asp</a><ul>
<li><code>event.clientX</code>: distance to the left border of <strong><u>viewport (position:fixed)</u></strong></li>
<li><code>event.screenX</code>: distance to the left border of <strong><u>browser</u></strong></li>
<li><code>event.pageX</code>: distance to the left border of <strong><u>document area(position: absolute)</u></strong></li>
</ul>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">    width: 500px;</span></span><br><span class="line"><span class="undefined">    height: 300px;</span></span><br><span class="line"><span class="undefined">    border: 1px solid black;</span></span><br><span class="line"><span class="undefined">    text-align: center;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">#demo2&#123;width: 500px;</span></span><br><span class="line"><span class="undefined">    height: 300px;</span></span><br><span class="line"><span class="undefined">    border: 1px solid red;</span></span><br><span class="line"><span class="undefined">    text-align: center;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onclick</span>=<span class="string">"showCoords(event)"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"pp"</span>&gt;</span>Click in the div element below to get the x (horizontal) and y (vertical) coordinates of the mouse pointer, when it is clicked.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> &gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"demo2"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Tip:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> Try to click different places in the div.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">showCoords</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> cX = event.clientX;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> cY = event.clientY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> sX = event.screenX;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> sY = event.screenY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> pX = event.pageX;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> pY = event.pageY;</span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> slX = scrollX;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> slY = scrollY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> pOffX = pageXOffset;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> pOffY = pageYOffset;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> coords1 = <span class="string">"client - X: "</span> + cX + <span class="string">", Y coords: "</span> + cY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> coords2 = <span class="string">"screen - X: "</span> + sX + <span class="string">", Y coords: "</span> + sY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> coords3 = <span class="string">"page - X: "</span>   + pX + <span class="string">", Y coords: "</span> + pY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> coords4 = <span class="string">"sroll - X: "</span>  + slX + <span class="string">", Y coords: "</span> + slY;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> coords5 = <span class="string">"pageOffset - X: "</span>  + pOffX + <span class="string">", Y coords: "</span> + pOffY;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">"demo2"</span>).innerHTML = coords1 + <span class="string">"&lt;br&gt;"</span> + coords2 + <span class="string">"&lt;br&gt;"</span> + coords3 + <span class="string">"&lt;br&gt;"</span> + coords4 + <span class="string">"&lt;br&gt;"</span> + coords5 + <span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="II-element-position"><a href="#II-element-position" class="headerlink" title="II. element position"></a>II. element position</h2><ol>
<li><code>getBoundingClientRect()</code>: <ul>
<li><code>top</code> ‚Äì Y-coordinate for the top element edge,</li>
<li><code>left</code> ‚Äì X-coordinate for the left element edge,</li>
<li><code>right</code> ‚Äì X-coordinate for the right element edge,</li>
<li><code>bottom</code> ‚Äì Y-coordinate for the bottom element edge.</li>
</ul>
</li>
<li><code>clientHeight</code>: the height of the element</li>
<li><code>offsetTop</code>:  returns the top position (in pixels) relative to the top of the offsetParent element. The returned value includes:<ul>
<li>the top position, and margin of the element</li>
<li>the top padding, scrollbar and border of the offsetParent element</li>
<li>The <a href="https://www.w3schools.com/jsref/prop_element_offsetparent.asp" target="_blank" rel="noopener">offsetParent</a> element is the nearest ancestor that has a position other than static.</li>
</ul>
</li>
<li><code>(clientX,clientY)</code>: window coordinates, correspond to <code>position:fixed</code>, </li>
<li><p><code>(pageX,pageY)</code>: document coordinates ,  correspond to <code>position:absolute</code></p>
</li>
<li><p>formular: </p>
<ul>
<li><code>pageY</code> = <code>clientY</code> + height of the scrolled-out vertical part of the document.</li>
<li><code>pageX</code> = <code>clientX</code> + width of the scrolled-out horizontal part of the document.</li>
</ul>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get document coordinates of the element</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCoords</span>(<span class="params">elem</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> box = elem.getBoundingClientRect();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    top: box.top + pageYOffset,</span><br><span class="line">    left: box.left + pageXOffset</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="III-Summary"><a href="#III-Summary" class="headerlink" title="III. Summary"></a>III. Summary</h2><p>Any point on the page has coordinates:</p>
<ol>
<li>Relative to the window ‚Äì <code>elem.getBoundingClientRect()</code>.</li>
<li>Relative to the document ‚Äì <code>elem.getBoundingClientRect()</code> plus the current page scroll.</li>
</ol>
<p>Window coordinates are great to use with <code>position:fixed</code>, and document coordinates do well with <code>position:absolute</code>.</p>
<p>Both coordinate systems have their ‚Äúpro‚Äù and ‚Äúcontra‚Äù, there are times we need one or the other one, just like CSS <code>position</code> <code>absolute</code> and <code>fixed</code>.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/10/Coding-Problem-find-the-1st-Bad-Version/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/10/Coding-Problem-find-the-1st-Bad-Version/" itemprop="url">Coding Problem: Find 1st Bad Version</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-10T22:19:23-07:00">2018-09-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="I-problem"><a href="#I-problem" class="headerlink" title="I. problem"></a>I. problem</h2><p>given 500 revisions of programs,  write a program that will find and return the FIRST bad revision given a <code>isBad(revision i)</code> function.</p>
<h2 id="II-Code"><a href="#II-Code" class="headerlink" title="II. Code"></a>II. Code</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isBad</span>(<span class="params"> version </span>)</span>&#123; <span class="keyword">return</span> version === <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">firstBadVersion</span>(<span class="params"> versions </span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">typeof</span> versions === <span class="string">'undefined'</span> || versions.length === <span class="number">0</span> ) </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> left = <span class="number">0</span>, right = versions.length<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>( left &lt; right )&#123;</span><br><span class="line">        <span class="keyword">let</span> mid = left + <span class="built_in">Math</span>.floor((right-left)/<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span>( isBad(versions[mid]) )&#123;</span><br><span class="line">            right = mid</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            left = mid+<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> versions[left]===<span class="number">0</span> ? left : <span class="number">-1</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Testing		  0 1 2 3 4 5 6  should return index: 4</span></span><br><span class="line"><span class="keyword">let</span> versions = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">versions = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line">versions = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">versions = [<span class="number">0</span>]</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">versions = [<span class="number">1</span>]</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">versions = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line">versions = []</span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion(versions))  <span class="comment">// -1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(firstBadVersion())  		<span class="comment">// -1</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/05/this-arrow-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/05/this-arrow-function/" itemprop="url">'this' & arrow function</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-05T21:51:55-07:00">2018-09-05</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="I-this-in-function"><a href="#I-this-in-function" class="headerlink" title="I. this in function"></a>I. <code>this</code> in function</h2><ol>
<li><p><strong>what is <code>this</code> ?</strong></p>
<ul>
<li>all <strong><u>regular</u></strong> functions have <code>this</code> keyword</li>
<li><code>this</code> determines how a function is called <strong><u>on whom</u></strong>!</li>
</ul>
</li>
<li><p><strong><code>this</code> in global context</strong></p>
<ul>
<li><p><code>this</code> refers  gloabl object, no matter in strict mode or not</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// In web browsers, the window object is also the global object:</span><br><span class="line">console.log(this === window); // true</span><br><span class="line"></span><br><span class="line">a = 37;</span><br><span class="line">console.log(window.a); // 37</span><br><span class="line"></span><br><span class="line">this.b = &quot;MDN&quot;;</span><br><span class="line">console.log(window.b)  // &quot;MDN&quot;</span><br><span class="line">console.log(b)         // &quot;MDN&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><u><strong><code>this</code> in function context [important]</strong></u></p>
<p>There are 7 cases that different function context results in different <code>this</code> reference;</p>
<blockquote>
<p><u>The value of <code>this</code></u> depend on how the function is called</p>
</blockquote>
<ol>
<li><p><code>this</code> in <strong><u>simple call</u></strong></p>
<ul>
<li><p>non-strict mode</p>
<p>if <code>this</code> is not set explicitly, it default to global object</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// In a browser:</span></span><br><span class="line">f1() === <span class="built_in">window</span>; <span class="comment">// true </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// In Node:</span></span><br><span class="line">f1() === global; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>strict mode</p>
<p>if <code>this</code> is not set explicitly, the value of <code>this</code> remains <code>undefined</code></p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>; <span class="comment">// see strict mode</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">f2() === <span class="literal">undefined</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>change the value of <code>this</code>, using <code>apply()</code> or <code>call()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// An object can be passed as the first argument to call or apply and this will be bound to it.</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="string">'Custom'</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This property is set on the global object</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'Global'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whatsThis</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.a;  <span class="comment">// The value of this is dependent on how the function is called</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">whatsThis();          <span class="comment">// 'Global'</span></span><br><span class="line">whatsThis.call(obj);  <span class="comment">// 'Custom'</span></span><br><span class="line">whatsThis.apply(obj); <span class="comment">// 'Custom'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>this</code> in <strong><u><code>bind()</code> method</u></strong></p>
<ul>
<li><p>NOTE: <code>bind()</code> doesn‚Äôt change the orignal function, instead it return a <strong><u>new function</u></strong> with updated value of <code>this</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.a; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = f.bind(&#123;<span class="attr">a</span>: <span class="string">'azerty'</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(g()); <span class="comment">// azerty</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h = g.bind(&#123;<span class="attr">a</span>: <span class="string">'yoo'</span>&#125;); <span class="comment">// bind only works once!</span></span><br><span class="line"><span class="built_in">console</span>.log(h()); <span class="comment">// azerty</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = &#123;<span class="attr">a</span>: <span class="number">37</span>, <span class="attr">f</span>: f, <span class="attr">g</span>: g, <span class="attr">h</span>: h&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(o.a, o.f(), o.g(), o.h()); <span class="comment">// 37,37, azerty, azerty</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>this</code> in <u><strong>arrow function</strong></u></p>
<ul>
<li><p><code>this</code> cannot be changed, it default to the value of the <strong><u>enclosing lexical context</u></strong>‚Äòs <code>this</code></p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> globalObject = <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">var</span> foo = <span class="function">(<span class="params">(</span>) =&gt;</span> <span class="keyword">this</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo() === globalObject); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>About <code>call()</code> &amp; <code>apply()</code></p>
<ul>
<li><p>if <code>this</code> arg is passed to call, bind, or apply on invocation of an arrow function it will be <strong><u>ignored</u></strong>.</p>
</li>
<li><p>the <code>thisArg</code> still works</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Call as a method of an object</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">func</span>: foo&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(obj.func() === globalObject); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Attempt to set this using call</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.call(obj) === globalObject); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Attempt to set this using bind</span></span><br><span class="line">foo = foo.bind(obj);</span><br><span class="line"><span class="built_in">console</span>.log(foo() === globalObject); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p><strong><u>another example:</u></strong>  <code>this</code> of arrow function, directly depends on its enclosing context </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create obj with a method bar that returns a function that</span></span><br><span class="line"><span class="comment">// returns its this. The returned function is created as </span></span><br><span class="line"><span class="comment">// an arrow function, so its this is permanently bound to the</span></span><br><span class="line"><span class="comment">// this of its enclosing function. The value of bar can be set</span></span><br><span class="line"><span class="comment">// in the call, which in turn sets the value of the </span></span><br><span class="line"><span class="comment">// returned function.</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">bar</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> x = <span class="function">(<span class="params">(</span>) =&gt;</span> <span class="keyword">this</span>);</span><br><span class="line">                    <span class="keyword">return</span> x;</span><br><span class="line">                  &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call bar as a method of obj, setting its this to obj</span></span><br><span class="line"><span class="comment">// Assign a reference to the returned function to fn</span></span><br><span class="line"><span class="keyword">var</span> fn = obj.bar();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call fn without setting this, would normally default</span></span><br><span class="line"><span class="comment">// to the global object or undefined in strict mode</span></span><br><span class="line"><span class="built_in">console</span>.log(fn() === obj); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// But caution if you reference the method of obj without calling it</span></span><br><span class="line"><span class="keyword">var</span> fn2 = obj.bar;</span><br><span class="line"><span class="comment">// Then calling the arrow function this is equals to window because it follows the this from bar.</span></span><br><span class="line"><span class="built_in">console</span>.log(fn2()() == <span class="built_in">window</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>this</code> in <u><strong>object method</strong></u></p>
<ul>
<li><p>When a function is called as a method of an object, its <code>this</code> is set to <strong><u>the object</u></strong> the method is called on.</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">  prop: <span class="number">37</span>,</span><br><span class="line">  f: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.prop;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.f()); <span class="comment">// 37</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>this</code> on the object‚Äôs prototype chain</p>
<p>If the method is on an object‚Äôs prototype chain, <code>this</code> refers to the object the method was called on, as if the method were on the object.</p>
</li>
</ul>
</li>
<li><p><code>this</code> in <u><strong>constructor</strong></u></p>
<ul>
<li><p><code>this</code> is bound to the <strong><u>new object being constructed</u></strong></p>
</li>
<li><p><strong>#A#</strong>  if <code>constructor</code> doesn‚Äôt return: result of <code>new</code> will be the object bound to <code>this</code></p>
</li>
<li><p><strong>#B#</strong>  if <code>constructor</code> return an object: result of <code>new</code> will be the return value</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.a = <span class="number">37</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> C();</span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 37</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">C2</span>(<span class="params"></span>) </span>&#123;   </span><br><span class="line">  <span class="keyword">this</span>.a = <span class="number">37</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;<span class="attr">a</span>: <span class="number">38</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// if an object was returned during construction, then the new object that this was bound to simply gets discarded.</span></span><br><span class="line"></span><br><span class="line">o = <span class="keyword">new</span> C2();</span><br><span class="line"><span class="built_in">console</span>.log(o.a); <span class="comment">// 38</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>this</code> in <u><strong>DOM event handler</strong></u></p>
<ul>
<li><p><del><code>this</code> is set to the <strong><u>target element</u></strong> the event fired from</del></p>
</li>
<li><p><code>this</code> is set to the <strong><u>current element</u></strong> to which the event handler is attached; not the target element</p>
</li>
<li><p><code>this === e.currentTarget</code></p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// When called as a listener, turns the related element blue</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bluify</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Always true</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span> === e.currentTarget); </span><br><span class="line">  <span class="comment">// true when currentTarget and target are the same object</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span> === e.target);</span><br><span class="line">  <span class="keyword">this</span>.style.backgroundColor = <span class="string">'#A5D9F3'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get a list of every element in the document</span></span><br><span class="line"><span class="keyword">var</span> elements = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'*'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add bluify as a click listener so when the</span></span><br><span class="line"><span class="comment">// element is clicked on, it turns blue</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span><br><span class="line">  elements[i].addEventListener(<span class="string">'click'</span>, bluify, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>this</code> in <u><strong>inline event handler</strong></u></p>
<ul>
<li><p><code>this</code> is set to the DOM element <strong><u>where the listener is placed</u></strong></p>
</li>
<li><p>however, only the outer code has its <code>this</code> set this way</p>
</li>
<li><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. this will refer to 'button' --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"alert(this.tagName.toLowerCase());"</span>&gt;</span></span><br><span class="line">  Show this</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2. 'this' will refer to 'window' --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"alert((function() &#123; return this; &#125;)());"</span>&gt;</span></span><br><span class="line">  Show inner this</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="II-arrow-function"><a href="#II-arrow-function" class="headerlink" title="II. arrow function"></a>II. arrow function</h2><ol>
<li><p>Best suited for <strong><u>non-method</u></strong> functions, ie. not related to method in <em>object</em></p>
</li>
<li><p>No separate <code>this</code> of its own, <em>using others‚Äô</em></p>
<ul>
<li><p>An arrow function does not have its own <code>this</code></p>
</li>
<li><p><code>this</code> value of the enclosing lexical context is used </p>
</li>
<li><p>how to find <code>this</code> of enclosing lexical context:</p>
<ul>
<li><p>check if <code>this</code>  is present in current scope;</p>
</li>
<li><p>check <code>this</code> is present in its enclosing scope;</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------- version1: works -----------------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.age++; <span class="comment">// |this| properly refers to the Person object</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------- version2: doesn't work ----------</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// The Person() constructor defines `this` as an instance of itself.</span></span><br><span class="line">  <span class="keyword">this</span>.age = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setInterval(<span class="function"><span class="keyword">function</span> <span class="title">growUp</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// In non-strict mode, the growUp() function defines `this` </span></span><br><span class="line">    <span class="comment">// as the global object (because it's where growUp() is executed.), </span></span><br><span class="line">    <span class="comment">// which is different from the `this`</span></span><br><span class="line">    <span class="comment">// defined by the Person() constructor. </span></span><br><span class="line">    <span class="keyword">this</span>.age++;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>No binding of <code>arguments</code></p>
<ul>
<li><p>Arrow functions do not have their own <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments" target="_blank" rel="noopener"><code>arguments</code> object</a>.</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">arguments</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> arr = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">arguments</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">arr(); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> f = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">arguments</span>[<span class="number">0</span>] + n; <span class="comment">// foo's implicit arguments binding. arguments[0] is n</span></span><br><span class="line">  <span class="keyword">return</span> f();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">3</span>); <span class="comment">// 6</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters" target="_blank" rel="noopener">rest parameters</a> is a good alternative to using an <code>arguments</code> object</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">n</span>) </span>&#123; </span><br><span class="line">  <span class="keyword">var</span> f = <span class="function">(<span class="params">...args</span>) =&gt;</span> args[<span class="number">0</span>] + n; </span><br><span class="line">  <span class="keyword">return</span> f(<span class="number">10</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>); <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><u><strong>When not use arrow function?  ==&gt;  when need <code>this</code> explicitly</strong> </u></p>
<ol>
<li><p>don‚Äôt use as <u>methods of object</u>: </p>
<ul>
<li><p>because we need <code>this</code>, but arrow function doesn‚Äôt have its own <code>this</code></p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">  i: 10,</span><br><span class="line">  b: () =&gt; console.log(this.i, this),</span><br><span class="line">  c: function() &#123;</span><br><span class="line">    console.log(this.i, this);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.b(); // prints undefined, Window &#123;...&#125; (or the global object)</span><br><span class="line">obj.c(); // prints 10, Object &#123;...&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>don‚Äôt use as <u>function constructor</u>:  because we will use <code>new</code> to construct , which need <code>this</code></p>
</li>
<li><p>don‚Äôt add <code>prototype</code> to it:  because it doesn‚Äôt have <code>this</code></p>
</li>
<li><p>don‚Äôt use in <code>yeild</code> or <code>generators</code>: </p>
</li>
</ol>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/31/Trie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/31/Trie/" itemprop="url">Trie</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-31T10:07:43-07:00">2018-08-31</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Algorithm/" itemprop="url" rel="index"><span itemprop="name">Algorithm</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="what"><a href="#what" class="headerlink" title="what"></a>what</h2><p>Trie, is actually a more general tree, also <strong>prefix tree</strong>.</p>
<p>Used for <strong><em>massive</em></strong> words process, dictionary representation, and lexicographic sorting, word frequency calc.</p>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><h4 id="I-TrieNode"><a href="#I-TrieNode" class="headerlink" title="I. TrieNode"></a>I. TrieNode</h4><p>TrieNode has mainly two parts:</p>
<ol>
<li><code>children</code>, to link next possible characters appear in a words. If only considering ‚ÄòA-Z‚Äô, there is 26 children at most</li>
<li>info used to record current TrieNode<ul>
<li><code>isWord</code>, denotes previous character is a word or not.</li>
<li><code>cnt</code>, denotes number of words consist of current prefix</li>
</ul>
</li>
</ol>
<p><strong><em>Note:</em></strong> this representation is a little different from binary tree, in which info data are stored for current Node. However, in Trie, info data are stored for previous Node, as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">For dictionary: &#123; <span class="string">"a"</span>, <span class="string">"bd"</span>, <span class="string">"c"</span> &#125;, the Trie would be represented as following:</span><br><span class="line"></span><br><span class="line"><span class="function">root <span class="title">TrieNode</span><span class="params">(<span class="number">0xefe4</span>)</span></span></span><br><span class="line"><span class="function">- cnt: 0</span></span><br><span class="line"><span class="function">- isWord: <span class="keyword">false</span></span></span><br><span class="line"><span class="function">- children:</span>&#123;<span class="string">'a'</span>: TrieNode , <span class="string">'b'</span>: TrieNode, <span class="string">'c'</span>: TrieNode, ... &#125;</span><br><span class="line">            /				      |				          \</span><br><span class="line">            TrieNode(<span class="number">0xffe3</span>)	TrieNode(<span class="number">0xffe4</span>)   			TrieNode(<span class="number">0xffe5</span>)</span><br><span class="line">            - cnt: <span class="number">1</span>			- cnt: <span class="number">0</span>					- cnt: <span class="number">1</span></span><br><span class="line">            - isWord: <span class="keyword">true</span>		- isWord: <span class="keyword">false</span>				- isWord: <span class="keyword">false</span></span><br><span class="line">            - children: <span class="keyword">null</span>	- children: &#123;<span class="string">'d'</span>:TrieNode&#125;  - children: <span class="keyword">null</span></span><br><span class="line">                                    |</span><br><span class="line">                                   ...</span><br></pre></td></tr></table></figure>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><ul>
<li><p>interfaces</p>
<ul>
<li>build (constructor)</li>
<li>isWord</li>
<li>countWord</li>
<li>insert</li>
<li>delete</li>
<li>hasPrefix</li>
<li>getPrefixNode</li>
</ul>
</li>
<li><p>Time Complexity: [ <code>n</code> words, <code>K</code> is number of characters of the longest word ]</p>
<ul>
<li>build: O(nK)</li>
<li>isWord: O(K)</li>
<li>countWord: O(K)</li>
<li>insert: O(K)</li>
<li>delete: O(K)</li>
</ul>
</li>
<li><p>Space Complexity: [<code>N</code> is the number of all characters appears in the dictionary ]</p>
<ul>
<li>too much space: O(N) +O(N^2) +O(N^3) +O(N^4) + O(N^K)</li>
<li>good news is: when it is a really dictionary, all the space will be filled up, so not so much waste</li>
</ul>
</li>
<li><p><code>delete</code> might be a little complex. The to-be-deleted word possibly :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">when need delete a node, what should really to be done????</span><br><span class="line">    - delete the key from HashMap&lt;Character, Node&gt;</span><br><span class="line">    - reset to <span class="keyword">null</span> when using Node[]</span><br><span class="line">So, always ask two questions:</span><br><span class="line">	- the node to be deleted, is part of other <span class="keyword">long</span> word [by checking <span class="string">'children'</span>]?</span><br><span class="line">    - the node itself is the end of a word? [by checking <span class="string">'isWord'</span> &amp; <span class="string">'cnt'</span>]?</span><br></pre></td></tr></table></figure>
<ul>
<li><code>null</code>, empty string, not exists in the Trie</li>
<li>contains other short words: ‚Äúabc‚Äù, ‚Äúab‚Äù<ul>
<li><strong>recursively from bottom to top</strong> delete node, till the longest prefix</li>
</ul>
</li>
<li>has same words as itself: ‚Äúabc‚Äù, ‚Äúabc‚Äù<ul>
<li>don‚Äôt delete node, only update <code>cnt</code></li>
</ul>
</li>
<li>being a prefix of other long words: ‚Äúabc‚Äù, ‚Äúabcde‚Äù<ul>
<li>don‚Äôt delete node, only update <code>isWord</code></li>
</ul>
</li>
<li>share prefix with other words: ‚Äúabc‚Äù, ‚Äúabd‚Äù<ul>
<li><strong>recursively from bottom to top</strong> delete node, till the longest prefix</li>
</ul>
</li>
<li>only itself in the dictionary, not affect others ‚Äúabc‚Äù<ul>
<li>delte all nodes</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> cnt;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">boolean</span> isWord;</span><br><span class="line">	<span class="keyword">public</span> Map&lt;Character, Node&gt; children;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cnt = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">this</span>.isWord = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">this</span>.children = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span></span>&#123;</span><br><span class="line">	Node root;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">( String[] strArr )</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.root = <span class="keyword">new</span> Node();</span><br><span class="line">		<span class="keyword">for</span>( String str : strArr )&#123;</span><br><span class="line">			insert( str );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasPrefix</span><span class="params">(String str )</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( str == <span class="keyword">null</span> || str.length() == <span class="number">0</span> ) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">int</span> len = str.length();</span><br><span class="line">		Node cur = <span class="keyword">this</span>.root;</span><br><span class="line">		<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++ )&#123;</span><br><span class="line">			<span class="keyword">char</span> ch = str.charAt(i);</span><br><span class="line">			<span class="keyword">if</span>( !cur.children.containsKey(ch) ) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			cur = cur.children.get(ch);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Node <span class="title">getPrefixNode</span> <span class="params">(String str)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( !hasPrefix(str) ) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">int</span> len = str.length();</span><br><span class="line">		Node cur = <span class="keyword">this</span>.root;</span><br><span class="line">		<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++ )&#123;</span><br><span class="line">			<span class="keyword">char</span> ch = str.charAt(i);</span><br><span class="line">			cur = cur.children.get(ch);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cur;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">( String str )</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( str == <span class="keyword">null</span> || str.length() == <span class="number">0</span> ) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">int</span> len = str.length();</span><br><span class="line">		Node cur = <span class="keyword">this</span>.root;</span><br><span class="line">		<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++ )&#123;</span><br><span class="line">			<span class="keyword">char</span> ch = str.charAt(i);</span><br><span class="line">			<span class="keyword">if</span>( !cur.children.containsKey(ch) )&#123;</span><br><span class="line">				cur.children.put( ch, <span class="keyword">new</span> Node() );</span><br><span class="line">			&#125;</span><br><span class="line">			cur = cur.children.get(ch);</span><br><span class="line">		&#125;</span><br><span class="line">		cur.cnt++;</span><br><span class="line">		cur.isWord = <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span> <span class="params">(String str )</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( str == <span class="keyword">null</span> || str.length() == <span class="number">0</span> ) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span>( !hasPrefix(str) ) <span class="keyword">return</span>;</span><br><span class="line">		Node cur = getPrefixNode(str);</span><br><span class="line">		cur.cnt--; </span><br><span class="line">		<span class="keyword">if</span>(cur.cnt &lt; <span class="number">0</span>) cur.cnt = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(cur.cnt &gt; <span class="number">0</span>) <span class="keyword">return</span>; 	<span class="comment">// at this position, there still word exist</span></span><br><span class="line">		<span class="keyword">else</span>&#123;						<span class="comment">// at this position, there no word exist</span></span><br><span class="line">			<span class="keyword">if</span>( cur.children.size() &gt; <span class="number">0</span> ) &#123;	<span class="comment">// but can be prefix of other words</span></span><br><span class="line">				cur.isWord = <span class="keyword">false</span>;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;							<span class="comment">// not a word, nor a prefix of others</span></span><br><span class="line">				deleteNode(str);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">( String str )</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> len = str.length();</span><br><span class="line">		<span class="keyword">if</span>( len == <span class="number">0</span> ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">		String prevStr = str.substring(<span class="number">0</span>, len-<span class="number">1</span>);</span><br><span class="line">		Node prevNode = getPrefixNode(prevStr);</span><br><span class="line">		prevNode.children.remove(str.charAt(len-<span class="number">1</span>));</span><br><span class="line">		<span class="keyword">if</span>( prevNode.children.size()==<span class="number">0</span> &amp;&amp; prevNode.cnt==<span class="number">0</span> ) delete(prevStr);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isWord</span><span class="params">( String str )</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( !hasPrefix(str) ) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">return</span> getPrefixNode(str).isWord;</span><br><span class="line">	&#125;	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">countWord</span><span class="params">( String str )</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( !hasPrefix(str) ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> getPrefixNode(str).cnt;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieTree</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span></span>&#123;</span><br><span class="line">		String[] dict = &#123; <span class="string">"a"</span>, <span class="string">"ab"</span>, <span class="string">"ab"</span>, <span class="string">"abc"</span>, <span class="string">"abc"</span>, <span class="string">"abc"</span>, <span class="string">"abcd"</span>, <span class="string">"ac"</span>, <span class="string">"acd"</span>, <span class="string">"ad"</span>, <span class="string">"2,24"</span>,  <span class="string">"2,2,4"</span> &#125;;</span><br><span class="line">		Trie trieTree = <span class="keyword">new</span> Trie(dict);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// String isWordTest1 = "ab";</span></span><br><span class="line">		<span class="comment">// String isWordTest2 = "";</span></span><br><span class="line">		<span class="comment">// String isWordTest3 = "a";</span></span><br><span class="line">		<span class="comment">// String isWordTest4 = "abcd";</span></span><br><span class="line">		<span class="comment">// String isWordTest5 = "abcde";</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// String countTest = "abc";</span></span><br><span class="line">		<span class="comment">// String insertTest = "abc";</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.isWord(isWordTest1));</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.isWord(isWordTest2));</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.isWord(isWordTest3));</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.isWord(isWordTest4));</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.isWord(isWordTest5));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.countWord(countTest));</span></span><br><span class="line">		<span class="comment">// trieTree.insert(insertTest);</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.countWord(countTest));</span></span><br><span class="line">		<span class="comment">// trieTree.insert(insertTest);</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.countWord(countTest));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// String hasPrefixTest1 = "abcd";</span></span><br><span class="line">		<span class="comment">// String hasPrefixTest2 = "2,2";</span></span><br><span class="line">		<span class="comment">// String hasPrefixTest3 = "abcdd";</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.hasPrefix(hasPrefixTest1));</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.hasPrefix(hasPrefixTest2));</span></span><br><span class="line">		<span class="comment">// System.out.println( trieTree.hasPrefix(hasPrefixTest3));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		String deleteTest1 = <span class="string">"abcd"</span>;</span><br><span class="line">		String deleteTest2 = <span class="string">"abc"</span>;</span><br><span class="line">		String deleteTest3 = <span class="string">"ab"</span>;</span><br><span class="line">		trieTree.delete(deleteTest1);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 3</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		trieTree.delete(deleteTest1);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 3</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		trieTree.delete(deleteTest2);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		trieTree.delete(deleteTest2);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 1</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		trieTree.delete(deleteTest2);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		trieTree.delete(deleteTest2);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 2</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		trieTree.delete(deleteTest3);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 1</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		trieTree.delete(deleteTest3);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		trieTree.delete(deleteTest1);</span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest3)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest2)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println( trieTree.countWord(deleteTest1)); <span class="comment">// 0</span></span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/12/Web-Worker-no-interfer-with-UI-thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/12/Web-Worker-no-interfer-with-UI-thread/" itemprop="url">Web Worker - not interfer with UI thread</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-12T14:12:33-07:00">2018-08-12</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="I-What"><a href="#I-What" class="headerlink" title="I. What"></a>I. What</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers</a></p>
<h2 id="II-To-be-continued"><a href="#II-To-be-continued" class="headerlink" title="II. To be continued"></a>II. To be continued</h2>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/11/How-to-Make-Animation-using-JS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/11/How-to-Make-Animation-using-JS/" itemprop="url">How to Make Animation using JS</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-11T22:56:29-07:00">2018-08-11</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="I-problem"><a href="#I-problem" class="headerlink" title="I. problem"></a>I. problem</h2><p>We want a function to move an <code>element</code> to its right by <code>distance</code> in specified <code>time</code></p>
<ul>
<li>API: <code>function moveToRight(ele, dis, time) {}</code></li>
</ul>
<h2 id="II-Implementation"><a href="#II-Implementation" class="headerlink" title="II. Implementation"></a>II. Implementation</h2><ol>
<li>must not be <code>position: static</code>: using <code>ele.style.left</code> + <code>ele.offsetLeft</code></li>
<li>no restrict on <code>position</code>: using `</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">	<span class="selector-id">#container</span>&#123;</span></span><br><span class="line"><span class="undefined">    	width: 100px;</span></span><br><span class="line"><span class="undefined">        height: 100px;</span></span><br><span class="line"><span class="undefined">    	border: 1px solid red;</span></span><br><span class="line"><span class="undefined">        position: relative;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// Version 1</span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">moveToRight_2</span>(<span class="params">ele, dis, time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> interval = <span class="number">10</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> oneStep = interval * dis / time</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> totalSteps = dis / oneStep</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> step = <span class="number">0</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> curLeft = ele.offsetLeft</span></span><br><span class="line"><span class="undefined"> </span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> interval_handler= setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">    curLeft += oneStep</span></span><br><span class="line"><span class="javascript">    ele.style.left = curLeft + <span class="string">'px'</span></span></span><br><span class="line"><span class="undefined">    step += 1</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>( step === totalSteps ) clearInterval(interval_handler)</span></span><br><span class="line"><span class="undefined">  &#125;, interval)</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="comment">// Version 2   </span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">moveToRight</span>(<span class="params">ele, dis, time</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> d = dis/time * <span class="number">10</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> cur = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> myInterval;</span></span><br><span class="line"><span class="undefined">  </span></span><br><span class="line"><span class="javascript">  myInterval = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span></span><br><span class="line"><span class="undefined">      cur += d;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (cur &lt;= dis) &#123;</span></span><br><span class="line"><span class="javascript">        ele.style.transform = <span class="string">"translate("</span> + cur +<span class="string">"px, 0)"</span>;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">         clearInterval(myInterval);</span></span><br><span class="line"><span class="javascript">         <span class="built_in">console</span>.log(<span class="string">"stop"</span>);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">  &#125;, 1);</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"> </span></span><br><span class="line"><span class="undefined">    </span></span><br><span class="line"><span class="javascript"><span class="comment">// Test  </span></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> ele = <span class="built_in">document</span>.getElementById(<span class="string">"container"</span>);</span></span><br><span class="line"><span class="undefined">moveToRight_2(ele, 100, 500);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Node-js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Node-js/" itemprop="url">Node.js</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T16:24:07-07:00">2018-06-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Event-driven-amp-asynchrous-IO-amp-Event-Emitter"><a href="#Event-driven-amp-asynchrous-IO-amp-Event-Emitter" class="headerlink" title="Event-driven &amp; asynchrous IO &amp; Event Emitter"></a>Event-driven &amp; asynchrous IO &amp; <code>Event Emitter</code></h2><ol>
<li><p><strong><u>NOTE :</u></strong></p>
<ul>
<li>Node.js is an application [<u><strong>a process</strong></u>]  in OS; but has <u><strong>multiple threads</strong></u></li>
<li><strong><u>Only one JS thread</u></strong>, all others are <strong><u>worker threads</u></strong> in thread pool used by OS</li>
<li>they share data via <strong><u>message queue</u></strong></li>
</ul>
</li>
<li><p><strong>Asynchrous I/O</strong></p>
<ul>
<li>Each I/O operation is assigned a <code>worker thread</code> in Node.js <u>run time env</u>; </li>
<li>But only one <code>master thread</code> (<u>js engine</u>) deal with computation</li>
</ul>
</li>
<li><p><strong>Even Loop</strong></p>
<ul>
<li><p><strong>Node.js</strong> ‚Äî  <strong>V8</strong> ‚Äî <strong>libuv</strong> ‚Äî <strong>OS</strong></p>
</li>
<li><p><strong>libuv [cross platform Asynchronous I/O]</strong>: handles utilize other threads to complete asynchronous I/O</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îå‚îÄ&gt;‚îÇ           timers          ‚îÇ</span><br><span class="line">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ  ‚îÇ     pending callbacks     ‚îÇ</span><br><span class="line">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ  ‚îÇ       idle, prepare       ‚îÇ</span><br><span class="line">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ   incoming:   ‚îÇ</span><br><span class="line">‚îÇ  ‚îÇ           poll            ‚îÇ&lt;‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  connections, ‚îÇ</span><br><span class="line">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ   data, etc.  ‚îÇ</span><br><span class="line">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">‚îÇ  ‚îÇ           check           ‚îÇ</span><br><span class="line">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br><span class="line">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">‚îî‚îÄ‚îÄ‚î§      close callbacks      ‚îÇ</span><br><span class="line">   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="Node-js-use-cases"><a href="#Node-js-use-cases" class="headerlink" title="Node.js use cases"></a>Node.js use cases</h2><ol>
<li><strong>I/O-bound application</strong><ul>
<li>Except the only one JS processing thread, all other threads deal with I/O operation, so that I/O processing can happend simultaneously =&gt; <strong>save time</strong></li>
<li>JS processing thread has no CPU-bound computation, only stay in <strong><u>event loop</u></strong>, and keep staring at the top of <strong><u>message queue</u></strong>; When some event done, handle its callbacks</li>
</ul>
</li>
</ol>
<h2 id="process-nextTick-vs-setImmediate"><a href="#process-nextTick-vs-setImmediate" class="headerlink" title="process.nextTick() vs. setImmediate()"></a><code>process.nextTick()</code> vs. <code>setImmediate()</code></h2><ol>
<li><strong><u>tick:</u></strong> each iteration of an Event Loop is called a <em>tick.</em></li>
<li><code>process.nextTick()</code> : will execute <strong><u>all callbacks</u></strong> set by it previousely in next tick</li>
<li><code>setImmediate()</code>: will execute <strong><u>only one callback</u></strong> in next tick, even set multiple callbacks</li>
</ol>
<h2 id="CommonJS-require-amp-exports"><a href="#CommonJS-require-amp-exports" class="headerlink" title="CommonJS: require &amp; exports"></a>CommonJS: <code>require</code> &amp; <code>exports</code></h2><ol>
<li><p><strong><u>Sad History</u></strong>: Before CommonJS, JavaScript doesn‚Äôt have module importing feature, so it is limited to small script, cannot be used to develop large project</p>
</li>
<li><p><strong><u>Current state :</u></strong> Many modules like <code>buffer</code>  <code>File</code>  <code>Http</code> <code>Socket</code> can be imported using <strong><em>CommonJS</em></strong></p>
</li>
<li><p><strong>Implementation:</strong></p>
<ul>
<li><p><code>module</code> is is <u><em>glolal object</em></u> in Node.js, have property <code>exports</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Before we step into the details, let‚Äôs see before CommonJS, how to use import function. The public functions are exposed while the private properties and methods are encapsulated</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> revealingModule = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> privateVar = <span class="string">"Ben Thomas"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setNameFn</span>(<span class="params"> strName </span>) </span>&#123;</span><br><span class="line">        privateVar = strName;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> &#123; <span class="attr">setName</span>: setNameFn, &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line">revealingModule.setName( <span class="string">"Paul Adams"</span> );</span><br></pre></td></tr></table></figure>
</li>
<li><p>When a module is exported, inside Node.js it will be wrapped as <code>IIFE</code> (Immediately Invoked Function Expression)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. original code</span></span><br><span class="line"><span class="keyword">var</span> greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Hello World'</span>); &#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = greet;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Parsed code by Node.js</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123; <span class="comment">//add by node.js</span></span><br><span class="line">      <span class="keyword">var</span> greet = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'Hello World'</span>); &#125;;</span><br><span class="line">      <span class="built_in">module</span>.exports = greet;</span><br><span class="line">&#125;).apply();                                        <span class="comment">//add by node.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong><u>How to use:</u></strong></p>
<ul>
<li><p>define module: <code>module.exports</code> or <code>exports</code> [<code>module.exports</code> === <code>exports</code>]</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* --- circle.js --- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1st way</span></span><br><span class="line">exports.area = <span class="function">(<span class="params">radius</span>) =&gt;</span> <span class="built_in">Math</span>.pow(radius, <span class="number">2</span>) * <span class="number">3.14</span>;</span><br><span class="line">exports.circunference = <span class="function">(<span class="params">radius</span>) =&gt;</span> <span class="number">2</span> * radius * <span class="number">3.14</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2nd way</span></span><br><span class="line"><span class="keyword">const</span> area = <span class="function">(<span class="params">radius</span>) =&gt;</span> <span class="built_in">Math</span>.pow(radius, <span class="number">2</span>) * <span class="number">3.14</span>;</span><br><span class="line"><span class="keyword">const</span> circunference = <span class="function">(<span class="params">radius</span>) =&gt;</span> <span class="number">2</span> * radius * <span class="number">3.14</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;<span class="attr">area</span>: area, <span class="attr">circumference</span>: circunference&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3rd way</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    area: <span class="function">(<span class="params">radius</span>) =&gt;</span> <span class="built_in">Math</span>.pow(radius, <span class="number">2</span>) * <span class="number">3.14</span>;</span><br><span class="line">    circunference: <span class="function">(<span class="params">radius</span>) =&gt;</span> <span class="number">2</span> * radius * <span class="number">3.14</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>use module everywhere:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> circle = <span class="built_in">require</span>(<span class="string">'./circle'</span>);</span><br><span class="line">circle.area(<span class="number">3</span>)</span><br><span class="line">circle.circunference(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="AMD-Asynchronous-Module-Definition"><a href="#AMD-Asynchronous-Module-Definition" class="headerlink" title="AMD: (Asynchronous Module Definition)"></a>AMD: (Asynchronous Module Definition)</h2><ol>
<li><p>Why need AMD?**</p>
<ul>
<li>Since Node.js are always running locally inside server, the <code>require</code> are instantly completed, i.e. <strong>synchronously</strong></li>
<li>Browser need to download js files from server <strong>asynchorously</strong>. While one file want <code>require</code> another, the other one might still not downloaded =&gt; <u>ERROR</u>!</li>
<li>Thus, we need another mechnism able to <strong><u>import modules asynchronously :</u></strong> AMD comes in!</li>
</ul>
</li>
<li><p><strong>How to use it in browser?</strong></p>
<ul>
<li><p><strong><u>[Good Article]</u></strong>: <a href="https://www.sitepoint.com/understanding-requirejs-for-effective-javascript-module-loading/" target="_blank" rel="noopener">https://www.sitepoint.com/understanding-requirejs-for-effective-javascript-module-loading/</a></p>
</li>
<li><p>use <code>define()</code> to declare the module dependency for each file</p>
</li>
<li><p>download <code>require.js</code> &amp; <code>main.js</code> in same project folder as other js files</p>
</li>
<li><p>only add one <code>&lt;script&gt;</code> tag to HTML is OK, as follows</p>
<ul>
<li><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-main</span>=<span class="string">"scripts/main"</span> <span class="attr">src</span>=<span class="string">"scripts/require.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><ol>
<li><p><strong>Request Method</strong></p>
<ul>
<li><p><code>request.method</code>: GET, POST, PUT, DELETE</p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">switch</span> (req.method) </span><br><span class="line">        <span class="keyword">case</span> <span class="string">'POST'</span>:</span><br><span class="line">   			update(req, res);</span><br><span class="line">    		<span class="keyword">break</span>;</span><br><span class="line">  		<span class="keyword">case</span> <span class="string">'DELETE'</span>:</span><br><span class="line">    		remove(req, res);</span><br><span class="line">    		<span class="keyword">break</span>;</span><br><span class="line">  		<span class="keyword">case</span> <span class="string">'PUT'</span>:</span><br><span class="line">    		create(req, res);</span><br><span class="line">   		 	<span class="keyword">break</span>;</span><br><span class="line">  		<span class="keyword">case</span> <span class="string">'GET'</span>:</span><br><span class="line">  		<span class="keyword">default</span>:</span><br><span class="line">			get(req, res); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Request URL</strong></p>
<ul>
<li><p>complete URL like the following: (<u>Hash part will be discarded</u>)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://user:pass@host.com:8080/p/a/t/h?query=string#hash</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>pathname</code> =  <code>url.parse(req.url).pathname</code></p>
</li>
<li><p><strong><u>routers in Node.js:</u></strong></p>
<ul>
<li><p>url: <code>/[controller]/[action]/a/b/c</code></p>
</li>
<li><p>handlers for different <u>controllers</u> &amp; <u>actions</u></p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routes different urls to their related handlers</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> pathname = url.parse(req.url).pathname;</span><br><span class="line">	<span class="keyword">var</span> paths = pathname.split(<span class="string">'/'</span>);</span><br><span class="line">	<span class="keyword">var</span> controller = paths[<span class="number">1</span>] || <span class="string">'index'</span>;</span><br><span class="line">	<span class="keyword">var</span> action = paths[<span class="number">2</span>] || <span class="string">'index'</span>;</span><br><span class="line">	<span class="keyword">var</span> args = paths.slice(<span class="number">3</span>);</span><br><span class="line">	<span class="keyword">if</span> (handles[controller] &amp;&amp; handles[controller][action]) &#123;</span><br><span class="line">		handles[controller][action].apply(<span class="literal">null</span>, [req, res].concat(args)); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		res.writeHead(<span class="number">500</span>);</span><br><span class="line">		res.end(<span class="string">'Êâæ‰∏çÂà∞ÂìçÂ∫îÊéßÂà∂Âô®'</span>); &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// handlers object</span></span><br><span class="line">handles.index = &#123;&#125;;</span><br><span class="line">handles.index.index = <span class="function"><span class="keyword">function</span> (<span class="params">req, res, foo, bar</span>) </span>&#123;</span><br><span class="line">	res.writeHead(<span class="number">200</span>);</span><br><span class="line">	res.end(foo); </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Request Query String</strong></p>
<ul>
<li><p><code>query</code> =  <code>url.parse(req.url).query</code></p>
</li>
<li><p>url: <code>/domainname/path?foo=bar&amp;baz=val</code></p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//eg1.  '/domainname/path?foo=bar&amp;baz=val' </span></span><br><span class="line">&#123;</span><br><span class="line">	foo: <span class="string">'bar'</span>,</span><br><span class="line">	baz: <span class="string">'val'</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg2.  '/domainname/path?foo=bar&amp;foo=val' </span></span><br><span class="line">&#123;</span><br><span class="line">	foo: [<span class="string">'bar'</span>, <span class="string">'val'</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Cookie</strong></p>
<ul>
<li><p>workflow: [ key point: browser sends cookie for each request]</p>
<ul>
<li>server sends cookie to browser</li>
<li>browser stores it in localstorage</li>
<li>browser sends cookie <u>every time making request</u></li>
</ul>
</li>
<li><p><strong>[For browser:]</strong>  string: <code>Cookie: foo=bar; baz=val</code>  =&gt; <code>req.header.cookie</code> </p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// browser parse cookie</span></span><br><span class="line"><span class="keyword">var</span> parseCookie = <span class="function"><span class="keyword">function</span> (<span class="params">cookie</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> cookies = &#123;&#125;;</span><br><span class="line">	<span class="keyword">if</span> (!cookie) &#123; <span class="keyword">return</span> cookies; &#125;</span><br><span class="line">	<span class="keyword">var</span> list = cookie.split(<span class="string">';'</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">		<span class="keyword">var</span> pair = list[i].split(<span class="string">'='</span>);</span><br><span class="line">		cookies[pair[<span class="number">0</span>].trim()] = pair[<span class="number">1</span>]; </span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> cookies; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// browser adds cookie to `req` object</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">	req.cookies = parseCookie(req.headers.cookie); </span><br><span class="line">    hande(req, res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>[For server:]</strong>  </p>
<ul>
<li><p>Format:</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: name=value; Path=/ ; Expires = Sun, 01/21/1987 09:01:01 GMT; Domain = .domain.com;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>arguments: </p>
<ul>
<li><code>name&amp;value</code>: the useful stuff</li>
<li><code>domain</code>: cookie only sent to the domain</li>
<li><code>path</code>: cookie only sent when this domain/path</li>
<li><code>expire</code> / <code>maxAge</code>: when or how long expires</li>
<li><code>HttpOnly</code>: will make this cookie cannot be access by <code>document.cookie</code></li>
<li><code>secure</code>: only sent when HTTPS; not sent when HTTP</li>
</ul>
</li>
<li><p><strong>Serialize Cookie [Server] : </strong>convert cookie to string</p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serialize = <span class="function"><span class="keyword">function</span> (<span class="params">name, val, opt</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> pairs = [name + <span class="string">'='</span> + encode(val)]; opt = opt || &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (opt.maxAge) pairs.push(<span class="string">'Max-Age='</span> + opt.maxAge);</span><br><span class="line">    <span class="keyword">if</span> (opt.domain) pairs.push(<span class="string">'Domain='</span> + opt.domain);</span><br><span class="line">	<span class="keyword">if</span> (opt.path) pairs.push(<span class="string">'Path='</span> + opt.path);</span><br><span class="line">    <span class="keyword">if</span> (opt.expires) pairs.push(<span class="string">'Expires='</span> + opt.expires.toUTCString()); </span><br><span class="line">    <span class="keyword">if</span> (opt.httpOnly) pairs.push(<span class="string">'HttpOnly'</span>);</span><br><span class="line">    <span class="keyword">if</span> (opt.secure) pairs.push(<span class="string">'Secure'</span>);</span><br><span class="line">    <span class="keyword">return</span> pairs.join(<span class="string">'; '</span>); </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Session</strong></p>
<ul>
<li><p><u><strong>why need it</strong></u>: <em>cookie with too much data</em> will make delay in network transmission </p>
</li>
<li><p><strong><u>Solution:</u></strong> </p>
<ul>
<li>store data on server side, give a key (sessionID) to cookie to refer its data</li>
<li>set <code>expire</code> to its corresponding  cookie</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Cache</strong> <strong><em><u>response file</u></em></strong> [ <u>has nothing to do with cookie</u> ]</p>
<ul>
<li>Client: <code>If-Modified-Since</code>,  Server:  <code>Last-Modified</code></li>
<li>Client: <code>If-None-Match</code>,  Server:  <code>ETag</code><ul>
<li>solve problem: even if file modified, but content didn‚Äôt modified</li>
<li>compare the digest of target file</li>
</ul>
</li>
<li>Server:  <code>Expires</code> / <code>Cache-Control</code><ul>
<li>the first 2 ways still need to send request, and wait for response =&gt; waste time!</li>
<li>This approach doesn‚Äôt need to send request if doesn‚Äôt <code>expires</code></li>
<li>But there is a problem: the time are not the same on two sides, <code>max-age</code> of <code>cache-control</code>comes in</li>
</ul>
</li>
<li>how to update cache when server file updated within expired period?<ul>
<li><strong><u>Problem</u></strong>: browser will use stale file, since it not expire</li>
<li>We also update the URL, since <em>Cache pairs with URL</em></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Authentication / Authorization</strong> </p>
<ul>
<li><u>basic authentication</u><ul>
<li>request with : <code>useranme</code> &amp; <code>password</code></li>
</ul>
</li>
<li><u>OAuth2.0</u><ul>
<li>request with <code>access_token</code></li>
</ul>
</li>
<li><u>Bearer token: JWT</u><ul>
<li>request with <code>Json Web Token</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Form Data</strong></p>
<ul>
<li>content-type: <code>application/x-www-form-urlencoded</code> (‚Äúfoo=bar&amp;baz=val‚Äù)</li>
<li>content-type: <code>application/json;</code></li>
<li>content-type: <code>application/xml;</code></li>
</ul>
</li>
<li><p><strong>Simulate a Client(browser) &amp; a Server</strong></p>
<ol>
<li><p>server implementation [send response as a server]</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">let</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">http.creatServer( <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> pathname = url.parse(req.url).pathname</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"request for "</span> + pathname + <span class="string">"received."</span>)</span><br><span class="line">    </span><br><span class="line">    fs.readFile(pathname.substr(<span class="number">1</span>), <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">            res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;)</span><br><span class="line">            res.write(data.toString())</span><br><span class="line">        &#125;</span><br><span class="line">        res.end()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).listen(<span class="number">8080</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Server running at http://127.0.0.1:8080/"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>client implementation [send request as a browser]</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> options =&#123;</span><br><span class="line">    host: <span class="string">'localhost'</span>,</span><br><span class="line">    port: <span class="string">'8080'</span>,</span><br><span class="line">    path: <span class="string">'/index.html'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> body = <span class="string">''</span></span><br><span class="line">    res.on( <span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        body += data</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    res.on( <span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(body)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> req = http.request(options, callback)</span><br><span class="line">req.end()</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="XSS-CSRF"><a href="#XSS-CSRF" class="headerlink" title="XSS / CSRF"></a>XSS / CSRF</h2><ol>
<li>XSS: cross site script<ul>
<li>inject script from unsafe input, and runs it to get cookie, ie sessionID</li>
<li><strong><u>[Solution]</u></strong>: convert to <u>HTML entities</u>: <code>&amp;</code> will be <code>&amp;amp;</code></li>
</ul>
</li>
<li>CSRF: <ul>
<li>don‚Äôt bother to get sessionID</li>
<li>lure customer to another website, while he is in middle of session of some weak-protection Bank website</li>
<li>the other website will submit a form to Bank website indicating transfer money</li>
<li>Bank website server cannot tell from whom that request is. It still believe that is from its customer since he is in the middle of the session</li>
<li><strong><u>[Solution]</u></strong>: <ul>
<li>the Bank form add another random hidden input field</li>
<li>each time receive request, check if the random value equal to sent one</li>
<li>This way the form cannot be duplicate</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="Global-variables"><a href="#Global-variables" class="headerlink" title="Global variables"></a>Global variables</h2><ol>
<li><code>console</code> <ul>
<li><code>console.log(&#39;11&#39;)</code></li>
</ul>
</li>
<li><code>process</code> <ul>
<li><code>process.exit(0)</code></li>
<li><code>process.nextTick(callback)</code></li>
</ul>
</li>
<li><code>__filename</code>: <strong><u>absolute path + name</u></strong> for the current script being executed</li>
<li><code>__dirname</code>: <strong><u>absolute path</u></strong> for the current script being executed</li>
</ol>
<h2 id="Util-Objects"><a href="#Util-Objects" class="headerlink" title="Util Objects"></a>Util Objects</h2><ol>
<li><code>util</code>: make one object inherit from the other one<ol>
<li><code>util.inherits(constructor, superConstructor)</code></li>
</ol>
</li>
</ol>
<h2 id="Versions"><a href="#Versions" class="headerlink" title="Versions"></a>Versions</h2><ol>
<li><strong>semantic versioning</strong> <ul>
<li>consists of three numbers, separated by periods, such as 2.3.0</li>
<li>the middle number has to be incremented, when new functionality is added</li>
<li>the first number has to be incremented, when compatibility is broken, so that existing code that uses the package might not work with the new version,</li>
</ul>
</li>
<li><strong>caret character (^)</strong><ul>
<li>any version compatible with the given number may be installed</li>
<li><code>^2.3.0</code> would mean that any version greater than or equal to 2.3.0 and less than 3.0.0 is allowed</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Express-Framework/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Express-Framework/" itemprop="url">Express Framework</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T14:44:43-07:00">2018-06-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="express"><a href="#express" class="headerlink" title="express()"></a><code>express()</code></h2><ol>
<li><p><code>let express = require(&#39;express&#39;)</code>: Creates an Express application</p>
</li>
<li><p><code>express.static(root, [options])</code>: serves <u><strong>static files</strong></u> and is based on <a href="https://expressjs.com/en/resources/middleware/serve-static.html" target="_blank" rel="noopener">serve-static</a>.</p>
<ul>
<li><p>here we can set <code>etag</code> <code>lastModified</code> <code>maxAge</code> etc.</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  dotfiles: <span class="string">'ignore'</span>,</span><br><span class="line">  etag: <span class="literal">false</span>,</span><br><span class="line">  extensions: [<span class="string">'htm'</span>, <span class="string">'html'</span>],</span><br><span class="line">  index: <span class="literal">false</span>,</span><br><span class="line">  maxAge: <span class="string">'1d'</span>,</span><br><span class="line">  redirect: <span class="literal">false</span>,</span><br><span class="line">  setHeaders: <span class="function"><span class="keyword">function</span> (<span class="params">res, path, stat</span>) </span>&#123;</span><br><span class="line">    res.set(<span class="string">'x-timestamp'</span>, <span class="built_in">Date</span>.now())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(express.static(<span class="string">'public'</span>, options))</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>express.Router([options])</code>: Creates a new <a href="https://expressjs.com/en/4x/api.html#router" target="_blank" rel="noopener">router</a> object. Refer to <strong>Routing</strong> section below</p>
</li>
</ol>
<h2 id="App"><a href="#App" class="headerlink" title="App"></a>App</h2><ol>
<li><p>The <code>app</code> object denotes the Express application</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">  res.send(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><strong><u>sub-app :</u></strong></p>
<ol>
<li><p><code>app.mountpath</code></p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express(); <span class="comment">// the main app</span></span><br><span class="line"><span class="keyword">var</span> admin = express(); <span class="comment">// the sub app</span></span><br><span class="line"></span><br><span class="line">admin.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(admin.mountpath); <span class="comment">// /admin</span></span><br><span class="line">  res.send(<span class="string">'Admin Homepage'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/admin'</span>, admin); <span class="comment">// mount the sub app</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>app.on(&#39;mount&#39;, callback(parent))</code></p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> admin = express();</span><br><span class="line"></span><br><span class="line">admin.on(<span class="string">'mount'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">parent</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Admin Mounted'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(parent); <span class="comment">// refers to the parent app</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">admin.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'Admin Homepage'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/admin'</span>, admin);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
</li>
<li><p><code>app.METHOD(path, callback [, callback ...])</code></p>
<ul>
<li>METHOD is the HTTP method of the request, such as GET, PUT, POST, and so on, <strong><u>in lowercase</u></strong>. </li>
<li><code>callback</code> can be: <ul>
<li>A middleware function.</li>
<li>A series of middleware functions (separated by commas).</li>
<li>An array of middleware functions.</li>
<li>A combination of all of the above.</li>
</ul>
</li>
</ul>
</li>
<li><p><code>app.listen([port[, host[, backlog]]][, callback])</code> : Starts a UNIX <strong><u>socket</u></strong> , binds and listens for connections on the specified host and port.</p>
</li>
<li><p><code>app.param([name], callback)</code>: Add callback triggers to <a href="https://expressjs.com/en/guide/routing.html#route-parameters" target="_blank" rel="noopener">route parameters</a>, where <code>name</code> is the name of the parameter or an array of them, and <code>callback</code> is the callback function. </p>
</li>
<li><p><code>app.path()</code>: returns the canonical path of the app, a string.</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line">  , blog = express()</span><br><span class="line">  , blogAdmin = express();</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/blog'</span>, blog);</span><br><span class="line">blog.use(<span class="string">'/admin'</span>, blogAdmin);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(app.path()); <span class="comment">// ''</span></span><br><span class="line"><span class="built_in">console</span>.log(blog.path()); <span class="comment">// '/blog'</span></span><br><span class="line"><span class="built_in">console</span>.log(blogAdmin.path()); <span class="comment">// '/blog/admin'</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>app.route(path)</code>: <strong><u>Returns an instance of a single route</u></strong></p>
<ol>
<li><p>Use <code>app.route()</code> to avoid duplicate route names</p>
</li>
<li><p>e.g. </p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.route(<span class="string">'/events'</span>)</span><br><span class="line">.all(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// runs for all HTTP verbs first</span></span><br><span class="line">  <span class="comment">// think of it as route specific middleware!</span></span><br><span class="line">&#125;)</span><br><span class="line">.get(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.json(...);</span><br><span class="line">&#125;)</span><br><span class="line">.post(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// maybe add a new event...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>app.use([path,] callback [, callback...])</code>: mount specified middleware at the specified path</p>
</li>
</ol>
<h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h2><ol>
<li><p><code>app.get( url, handler )</code>    </p>
</li>
<li><p><code>app.post( url, handler )</code></p>
</li>
<li><p><code>app.put( url, handler )</code></p>
</li>
<li><p><code>app.delete( url, handler )</code></p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    res.send(<span class="string">"Hello world"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>app.all( url, handler )</code>: special route method to load all headlers for GET, POST, PUT, DELETE, etc,</p>
</li>
<li><p><strong>route parameters</strong></p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app.get(<span class="string">'/users/:userId/books/:bookId'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(req.params)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// If Request URL: http://localhost:3000/users/34/books/8989</span></span><br><span class="line"><span class="comment">// Then req.params: &#123; "userId": "34", "bookId": "8989" &#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><strong>route handlers</strong>: </p>
<ul>
<li><p><u>Multiple route handlers</u> can be put inside a route as <em>function array</em></p>
</li>
<li><p>use <code>next()</code> to invoke the next handler to handle route</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/example/d'</span>, [cb0, cb1], <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'the response will be sent by the next function ...'</span>)</span><br><span class="line">  next()</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'Hello from D!'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>app.route()</code></p>
<ul>
<li><p>create chainable route handlers for a route path by using <code>app.route()</code></p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app.route(<span class="string">'/book'</span>)</span><br><span class="line">  .get(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'Get a random book'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .post(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'Add a book'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .put(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.send(<span class="string">'Update the book'</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>express.Router()</code>: achieve <u><em>relative</em></u> &amp; <u><em>modular</em></u> route handling</p>
<ul>
<li><p>using <code>express.Router()</code> to create a modular route, which can handle relative route as a single module/ file</p>
</li>
<li><p>then pass it to the <u><em>abosolute route handling module</em></u></p>
</li>
<li><p><strong><u>[e.g. ]:</u></strong> The app will now be able to handle requests to <code>/birds</code> and <code>/birds/about</code>, as well as call the <code>timeLog</code> middleware function that is specific to the route.</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*--- bird.js : modular route handler ---*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> router = express.Router()</span><br><span class="line"></span><br><span class="line"><span class="comment">// middleware that is specific to this router</span></span><br><span class="line">router.use(<span class="function"><span class="keyword">function</span> <span class="title">timeLog</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Time: '</span>, <span class="built_in">Date</span>.now())</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// define the home page route</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'Birds home page'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// define the about route</span></span><br><span class="line">router.get(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">'About birds'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*--- app.js: include bird route handler ---*/</span></span><br><span class="line"><span class="keyword">var</span> birds = <span class="built_in">require</span>(<span class="string">'./birds'</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">app.use(<span class="string">'/birds'</span>, birds)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><ol>
<li><p>Credit to: <a href="https://segmentfault.com/a/1190000010877994" target="_blank" rel="noopener">https://segmentfault.com/a/1190000010877994</a></p>
</li>
<li><p>different levels of middleware</p>
<ul>
<li><p><a href="https://expressjs.com/en/guide/using-middleware.html#middleware.application" target="_blank" rel="noopener">Application-level middleware</a>: <code>app.use()</code></p>
</li>
<li><p><a href="https://expressjs.com/en/guide/using-middleware.html#middleware.router" target="_blank" rel="noopener">Router-level middleware</a> <code>router.use()</code></p>
</li>
<li><p><a href="https://expressjs.com/en/guide/using-middleware.html#middleware.built-in" target="_blank" rel="noopener">Built-in middleware</a>  <code>express.static()</code></p>
</li>
<li><p><a href="https://expressjs.com/en/guide/using-middleware.html#middleware.third-party" target="_blank" rel="noopener">Third-party middleware</a> <code>app.use(cookieParser())</code></p>
<ul>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">var</span> app = express()</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// load the cookie-parsing middleware</span></span><br><span class="line">app.use(cookieParser())</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>write our own middleware!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. create our own middleware</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> App))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> App();</span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">&#125;</span><br><span class="line">App.prototype = &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: App,</span><br><span class="line">    init: function() &#123;</span><br><span class="line">        <span class="keyword">this</span>.request = &#123; <span class="comment">//Ê®°ÊãüÁöÑrequest</span></span><br><span class="line">            requestLine: <span class="string">'POST /iven_ HTTP/1.1'</span>,</span><br><span class="line">            headers: <span class="string">'Host:www.baidu.com\r\nCookie:BAIDUID=E063E9B2690116090FE24E01ACDDF4AD:FG=1;BD_HOME=0'</span>,</span><br><span class="line">            requestBody: <span class="string">'key1=value1&amp;key2=value2&amp;key3=value3'</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.response = &#123;&#125;; <span class="comment">//Ê®°ÊãüÁöÑresponse</span></span><br><span class="line">        <span class="keyword">this</span>.chain = []; <span class="comment">//Â≠òÊîæ‰∏≠Èó¥‰ª∂ÁöÑ‰∏Ä‰∏™Êï∞ÁªÑ</span></span><br><span class="line">        <span class="keyword">this</span>.index = <span class="number">0</span>; <span class="comment">//ÂΩìÂâçÊâßË°åÁöÑ‰∏≠Èó¥‰ª∂Âú®chain‰∏≠ÁöÑ‰ΩçÁΩÆ</span></span><br><span class="line">    &#125;,</span><br><span class="line">    use: <span class="function"><span class="keyword">function</span>(<span class="params">handle</span>) </span>&#123; <span class="comment">//ËøôÈáåÈªòËÆ§ handle ÊòØÂáΩÊï∞ÔºåÂπ∂‰∏îËøôÈáå‰∏çÂÅöÂà§Êñ≠</span></span><br><span class="line">        <span class="keyword">this</span>.chain.push(handle);</span><br><span class="line">    &#125;,</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//ÂΩìË∞ÉÁî®nextÊó∂ÊâßË°åindexÊâÄÊåáÂêëÁöÑ‰∏≠Èó¥‰ª∂</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.index &gt;= <span class="keyword">this</span>.chain.length)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">let</span> middleware = <span class="keyword">this</span>.chain[<span class="keyword">this</span>.index];</span><br><span class="line">        <span class="keyword">this</span>.index++;</span><br><span class="line">        middleware(<span class="keyword">this</span>.request, <span class="keyword">this</span>.response, <span class="keyword">this</span>.next.bind(<span class="keyword">this</span>));</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.  use it</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">lineParser</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> items = req.requestLine.split(<span class="string">' '</span>);</span><br><span class="line">        req.methond = items[<span class="number">0</span>];</span><br><span class="line">        req.url = items[<span class="number">1</span>];</span><br><span class="line">        req.version = items[<span class="number">2</span>];</span><br><span class="line">        next(); <span class="comment">//ÊâßË°å‰∏ã‰∏Ä‰∏™‰∏≠Èó¥‰ª∂</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">headersParser</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> items = req.headers.split(<span class="string">'\r\n'</span>);</span><br><span class="line">    <span class="keyword">let</span> header = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> items) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = items[i].split(<span class="string">':'</span>);</span><br><span class="line">        <span class="keyword">let</span> key = item[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">let</span> value = item[<span class="number">1</span>];</span><br><span class="line">        header[key] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    req.header = header;</span><br><span class="line">    next(); <span class="comment">//ÊâßË°å‰∏ã‰∏Ä‰∏™‰∏≠Èó¥‰ª∂</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = App();</span><br><span class="line">app.use(lineParser);</span><br><span class="line">app.use(headersParser);</span><br><span class="line">app.next();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="request"><a href="#request" class="headerlink" title="request"></a>request</h2><p>The <code>req</code> object represents the HTTP request and has properties for the <em>request query string</em>, <em>parameters</em>, <em>body</em>, <em>HTTP headers</em>, and so on</p>
<ol>
<li><p><code>req.baseUrl</code>: </p>
<ul>
<li><p>The URL path on which a router instance was mounted; </p>
</li>
<li><p>similar to the <a href="https://expressjs.com/en/4x/api.html#app.mountpath" target="_blank" rel="noopener">mountpath</a> property of the <code>app</code> object, except <code>app.mountpath</code> returns the matched path pattern(s).</p>
</li>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> greet = express.Router();</span><br><span class="line"></span><br><span class="line">greet.get(<span class="string">'/jp'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.baseUrl); <span class="comment">// /greet</span></span><br><span class="line">  res.send(<span class="string">'Konichiwa!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/greet'</span>, greet); <span class="comment">// load the router on '/greet'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>req.body</code>:  key-value pairs of data submitted in the request body; Need <code>body-parser()</code></p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json()); <span class="comment">// for parsing application/json</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;)); <span class="comment">// for parsing application/x-www-form-urlencoded</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Now all JSON &amp; Raw text are parsed, and ready to use as `req.body`</span></span><br><span class="line">app.post(<span class="string">'/profile'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">  res.json(req.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>req.cookies</code>:   using <code>cookie-parse</code> to set cookies onto request</p>
</li>
<li><p><code>req.hostname</code> : hostname of the <code>Host</code> HTTP header.</p>
</li>
<li><p><code>req.ip</code>:  remote IP address of the request.</p>
</li>
<li><p><code>req.method</code>: method of request: <code>GET</code>, <code>POST</code>, <code>PUT</code>, and so on.</p>
</li>
<li><p><code>req.originalUrl</code> vs <code>req.baseUrl</code> vs <code>req.path</code>: </p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">'/admin'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;  <span class="comment">// GET 'http://www.example.com/admin/new'</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.originalUrl); <span class="comment">// '/admin/new'</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.baseUrl); <span class="comment">// '/admin'</span></span><br><span class="line">  <span class="built_in">console</span>.log(req.path); <span class="comment">// '/new'</span></span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>req.query</code>: object containing a property for each query string parameter in the route</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GET /search?q=tobi+ferret</span></span><br><span class="line">req.query.q</span><br><span class="line"><span class="comment">// =&gt; "tobi ferret"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GET /shoes?order=desc&amp;shoe[color]=blue&amp;shoe[type]=converse</span></span><br><span class="line">req.query.order</span><br><span class="line"><span class="comment">// =&gt; "desc"</span></span><br><span class="line"></span><br><span class="line">req.query.shoe.color</span><br><span class="line"><span class="comment">// =&gt; "blue"</span></span><br><span class="line"></span><br><span class="line">req.query.shoe.type</span><br><span class="line"><span class="comment">// =&gt; "converse"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>req.route</code>: currently-matched route, a string. </p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/user/:id?'</span>, <span class="function"><span class="keyword">function</span> <span class="title">userIdHanler</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.route);</span><br><span class="line">  res.send(<span class="string">'GET'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">==&gt;</span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">'/user/:id?'</span>,</span><br><span class="line">  stack:</span><br><span class="line">   [ &#123; <span class="attr">handle</span>: [<span class="built_in">Function</span>: userIdHandler],</span><br><span class="line">       name: <span class="string">'userIdHandler'</span>,</span><br><span class="line">       params: <span class="literal">undefined</span>,</span><br><span class="line">       path: <span class="literal">undefined</span>,</span><br><span class="line">       keys: [],</span><br><span class="line">       regexp: <span class="regexp">/^\/?$/i</span>,</span><br><span class="line">       method: <span class="string">'get'</span> &#125; ],</span><br><span class="line">  methods: &#123; <span class="attr">get</span>: <span class="literal">true</span> &#125; &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h2 id="response"><a href="#response" class="headerlink" title="response"></a>response</h2><p>represents the HTTP response that an Express app sends when it gets an HTTP request.</p>
<ol>
<li><p><code>res.app</code> === <code>req.app</code>: a reference to the instance of the Express application that is using the middleware.</p>
</li>
<li><p><code>res.headersSent</code>:  indicates if the app sent HTTP headers for the response.</p>
</li>
<li><p><code>res.append(field [, value])</code>: Appends the specified <code>value</code> to the HTTP response header <code>field</code></p>
</li>
<li><p><code>res.cookie(name, value [, options])</code>: Sets cookie <code>name</code> to <code>value</code></p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(<span class="string">'name'</span>, <span class="string">'tobi'</span>, &#123; <span class="attr">domain</span>: <span class="string">'.example.com'</span>, <span class="attr">path</span>: <span class="string">'/admin'</span>, <span class="attr">secure</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">res.cookie(<span class="string">'rememberme'</span>, <span class="string">'1'</span>, &#123; <span class="attr">expires</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.now() + <span class="number">900000</span>), <span class="attr">httpOnly</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">//Default encoding</span></span><br><span class="line">res.cookie(<span class="string">'some_cross_domain_cookie'</span>, <span class="string">'http://mysubdomain.example.com'</span>,&#123;<span class="attr">domain</span>:<span class="string">'example.com'</span>&#125;);</span><br><span class="line"><span class="comment">// Result: 'some_cross_domain_cookie=http%3A%2F%2Fmysubdomain.example.com; Domain=example.com; Path=/'</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.clearCookie(name [, options])</code>: Clears the cookie specified by <code>name</code>.</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(<span class="string">'name'</span>, <span class="string">'tobi'</span>, &#123; <span class="attr">path</span>: <span class="string">'/admin'</span> &#125;);</span><br><span class="line">res.clearCookie(<span class="string">'name'</span>, &#123; <span class="attr">path</span>: <span class="string">'/admin'</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.download(path [, filename] [, options] [, fn])</code>: Transfers the file at <code>path</code> as an ‚Äú<em>attachment</em>‚Äù. Typically, browsers will prompt the user for download. </p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">res.download(<span class="string">'/report-12345.pdf'</span>, <span class="string">'report.pdf'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="comment">// Handle error, but keep in mind the response may be partially-sent</span></span><br><span class="line">    <span class="comment">// so check res.headersSent</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// decrement a download credit, etc.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.end([data] [, encoding])</code>: Ends the response process</p>
<ol>
<li>If you need to respond with data, instead use methods such as <a href="https://expressjs.com/en/4x/api.html#res.send" target="_blank" rel="noopener">res.send()</a>and <a href="https://expressjs.com/en/4x/api.html#res.json" target="_blank" rel="noopener">res.json()</a>.</li>
</ol>
</li>
<li><p><code>res.format(object)</code>: when present. It uses <a href="https://expressjs.com/en/4x/api.html#req.accepts" target="_blank" rel="noopener">req.accepts()</a> to select a handler for the request</p>
<ol>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">``res.format(&#123;</span><br><span class="line">  &apos;text/plain&apos;: function()&#123;</span><br><span class="line">    res.send(&apos;hey&apos;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &apos;text/html&apos;: function()&#123;</span><br><span class="line">    res.send(&apos;&lt;p&gt;hey&lt;/p&gt;&apos;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &apos;application/json&apos;: function()&#123;</span><br><span class="line">    res.send(&#123; message: &apos;hey&apos; &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &apos;default&apos;: function() &#123;</span><br><span class="line">    // log the request and respond with 406</span><br><span class="line">    res.status(406).send(&apos;Not Acceptable&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.set(field, vale)</code>: set response header</p>
</li>
<li><p><code>res.get(field)</code>: get HTTP response header specified by <code>field</code></p>
</li>
<li><p><code>res.json([body])</code>: Sends a JSON response.</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.json(&#123; <span class="attr">user</span>: <span class="string">'tobi'</span> &#125;);</span><br><span class="line">res.status(<span class="number">500</span>).json(&#123; <span class="attr">error</span>: <span class="string">'message'</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.redirect([status,] path)</code>: Redirects to the URL derived from the specified <code>path</code>, with specified <code>status</code></p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.redirect(<span class="number">301</span>, <span class="string">'http://example.com'</span>);</span><br><span class="line">res.redirect(<span class="string">'../login'</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.send([body])</code>: Sends the HTTP response.</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res.send(<span class="keyword">new</span> Buffer(<span class="string">'whoop'</span>));</span><br><span class="line">res.send(&#123; <span class="attr">some</span>: <span class="string">'json'</span> &#125;);</span><br><span class="line">res.send(<span class="string">'&lt;p&gt;some html&lt;/p&gt;'</span>);</span><br><span class="line">res.status(<span class="number">404</span>).send(<span class="string">'Sorry, we cannot find that!'</span>);</span><br><span class="line">res.status(<span class="number">500</span>).send(&#123; <span class="attr">error</span>: <span class="string">'something blew up'</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.sendFile(path [, options] [, fn])</code>: Transfers the file at the given <code>path</code>.</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/file/:name'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> options = &#123;</span><br><span class="line">    root: __dirname + <span class="string">'/public/'</span>,</span><br><span class="line">    dotfiles: <span class="string">'deny'</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'x-timestamp'</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">        <span class="string">'x-sent'</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fileName = req.params.name;</span><br><span class="line">  res.sendFile(fileName, options, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      next(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Sent:'</span>, fileName);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p><code>res.sendStatus(statusCode)</code>:  Sets the response HTTP status code to <code>statusCode</code> and send its string representation as the response body.</p>
<ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.sendStatus(<span class="number">200</span>); <span class="comment">// equivalent to res.status(200).send('OK')</span></span><br><span class="line">res.sendStatus(<span class="number">403</span>); <span class="comment">// equivalent to res.status(403).send('Forbidden')</span></span><br><span class="line">res.sendStatus(<span class="number">404</span>); <span class="comment">// equivalent to res.status(404).send('Not Found')</span></span><br><span class="line">res.sendStatus(<span class="number">500</span>); <span class="comment">// equivalent to res.status(500).send('Internal Server Error')</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h2 id="bodyParser"><a href="#bodyParser" class="headerlink" title="bodyParser"></a><code>bodyParser</code></h2><ol>
<li><p><code>urlencoded</code> format data submitted from <code>&lt;form&gt;</code>Ôºåcan be parsed into<code>res.body</code></p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>json</code> format data transferred using API, can be parsed into <code>res.body</code></p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(bodyParser.json());</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="set-set-globle-variable-in-Express"><a href="#set-set-globle-variable-in-Express" class="headerlink" title="set(): set globle variable in Express"></a><code>set()</code>: set globle variable in Express</h2><blockquote>
<p>You can use the express instance to store and retrieve variables. In this case, you can set the title to be ‚ÄúMy Site‚Äù and retrieve it later with something like <code>var title = app.get(&#39;title&#39;);</code><strong>without the need to declare and keep a global variable messing around</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.set(&apos;title&apos;,&apos;My Website&apos;);  // set()</span><br><span class="line">var title = app.get(&apos;title&apos;);   // get()</span><br><span class="line"></span><br><span class="line">&lt;=&gt;</span><br><span class="line"></span><br><span class="line">title = &apos;My Website&apos;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/21/Authetication-JWT-vs-Session/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mingkai Cao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mingkai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CMK">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/21/Authetication-JWT-vs-Session/" itemprop="url">Authetication: JWT vs Session</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-21T21:59:55-07:00">2018-05-21</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Full-stack/" itemprop="url" rel="index"><span itemprop="name">Full stack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="I-Why-do-we-need-Authetication"><a href="#I-Why-do-we-need-Authetication" class="headerlink" title="I. Why do we need Authetication?"></a>I. Why do we need Authetication?</h2><p><strong>Scenario: bank accout transaction</strong></p>
<blockquote>
<p>Authetication: an approach to know ‚ÄúAlice‚Äù from client side is the real ‚ÄúAlice‚Äù in the bank database</p>
</blockquote>
<p>The bank web server needs a way to identify its customers‚Äô true identity, knowing ‚ÄòAlice‚Äô is the real ‚ÄòAlice‚Äô as she claims.</p>
<h2 id="II-session-amp-cookie-authetication"><a href="#II-session-amp-cookie-authetication" class="headerlink" title="II. session&amp;cookie authetication"></a>II. <code>session&amp;cookie</code> authetication</h2><p><strong>1. Solution A</strong>   </p>
<p>An approach is checking her account&amp;password. If matches, she can access Alice‚Äôs bank account; Otherwise, no way to Alice‚Äôs bank account.</p>
<p><strong>2. Problem of Solution A</strong> </p>
<p>HTTP is stateless. After Alice log into the server, next time when Alice make another request to draw ¬•100 from her account (<em>subtract ¬•100 from her accout</em>). Now she still needs to prove she is Alice. But asking her accout&amp;password again and again is rediculous!</p>
<p><strong>3. Solution B:<code>session</code> &amp; <code>cookie</code></strong> </p>
<ul>
<li>First time, the Alice log into her account on bank server; </li>
<li>Bank server maintains a session for her, and issues <code>sessionID</code> to her <code>cookie</code>. </li>
<li>Later, each time Alice want to make a transaction, she makes HTTP requests with that <code>sessionID</code>(all HTTP requests carry <code>cookie</code> )</li>
<li>Until a certain period of time, the <code>session</code> for Alice become invalid if no activities from Alice</li>
<li>After a inactive period, if Alice wants to make transaction again, she has to log into system to set up a new <code>session</code> in bank server</li>
<li><code>Server</code>is the safe guard**, preventing evil from accessing sensitive bank account information. Using <code>session</code>and<code>cookie</code>, customers finally don‚Äôt have to input their account&amp;password again and again!</li>
</ul>
<p><strong>4. New problem in ‚Äúdistributed‚Äù serivce system</strong>   </p>
<ul>
<li><p><strong><code>Distributed</code></strong> means: after Alice log into her account on server#1, next time she might be directed by <code>load balancer</code> to server#2, if at that time server#1 is already serving extremely large amount of people.</p>
</li>
<li><p><strong>New problem is:</strong> <code>session &amp; cookie</code> approach doesn‚Äôt work in this case. Server#1 has Alice‚Äôs necessary<code>context</code> for following transaction after she logs into it. But server#2 doesn‚Äôt even know who she is! So, Alice is asked for her account and password again! Bad user experience!!!</p>
</li>
</ul>
<p><strong>5. Soutions for ‚Äúdistributed‚Äù serivce system</strong>   </p>
<blockquote>
<p>„ÄêÂ•ΩÊñá„Äë<a href="https://www.cnblogs.com/study-everyday/p/7853145.html" target="_blank" rel="noopener">https://www.cnblogs.com/study-everyday/p/7853145.html</a></p>
</blockquote>
<ul>
<li><strong>version 1: session dupication (Â§öÊú∫ÂêåÊ≠•)</strong><ul>
<li>ÊÄùË∑ØÔºöÂ§ö‰∏™web-server‰πãÈó¥Áõ∏‰∫íÂêåÊ≠•sessionÔºåËøôÊ†∑ÊØè‰∏™web-server‰πãÈó¥ÈÉΩÂåÖÂê´ÂÖ®ÈÉ®ÁöÑsession</li>
<li>‰ºòÁÇπÔºöweb-serverÊîØÊåÅÁöÑÂäüËÉΩÔºåÂ∫îÁî®Á®ãÂ∫è‰∏çÈúÄË¶Å‰øÆÊîπ‰ª£Á†Å</li>
<li>‰∏çË∂≥Ôºö<ul>
<li>sessionÁöÑÂêåÊ≠•ÈúÄË¶ÅÊï∞ÊçÆ‰º†ËæìÔºåÂç†ÂÜÖÁΩëÂ∏¶ÂÆΩÔºåÊúâÊó∂Âª∂</li>
<li>ÊâÄÊúâweb-serverÈÉΩÂåÖÂê´ÊâÄÊúâsessionÊï∞ÊçÆÔºåÊï∞ÊçÆÈáèÂèóÂÜÖÂ≠òÈôêÂà∂ÔºåÊó†Ê≥ïÊ∞¥Âπ≥Êâ©Â±ï</li>
<li>ÊúâÊõ¥Â§öweb-serverÊó∂Ë¶ÅÊ≠áËèú</li>
</ul>
</li>
</ul>
</li>
<li><strong>version 2: Session Storage at brower (ÂÆ¢Êà∑Á´ØÂ≠òÂÇ®Ê≥ï)</strong><ul>
<li>ÊÄùË∑ØÔºöÊúçÂä°Á´ØÂ≠òÂÇ®ÊâÄÊúâÁî®Êà∑ÁöÑsessionÔºåÂÜÖÂ≠òÂç†Áî®ËæÉÂ§ßÔºåÂèØ‰ª•Â∞ÜsessionÂ≠òÂÇ®Âà∞ÊµèËßàÂô®cookie‰∏≠ÔºåÊØè‰∏™Á´ØÂè™Ë¶ÅÂ≠òÂÇ®‰∏Ä‰∏™Áî®Êà∑ÁöÑÊï∞ÊçÆ‰∫Ü</li>
<li>‰ºòÁÇπÔºöÊúçÂä°Á´Ø‰∏çÈúÄË¶ÅÂ≠òÂÇ®</li>
<li>Áº∫ÁÇπÔºö<ul>
<li>ÊØèÊ¨°httpËØ∑Ê±ÇÈÉΩÊê∫Â∏¶sessionÔºåÂç†Â§ñÁΩëÂ∏¶ÂÆΩ</li>
<li>Êï∞ÊçÆÂ≠òÂÇ®Âú®Á´Ø‰∏äÔºåÂπ∂Âú®ÁΩëÁªú‰º†ËæìÔºåÂ≠òÂú®Ê≥ÑÊºè„ÄÅÁØ°Êîπ„ÄÅÁ™ÉÂèñÁ≠âÂÆâÂÖ®ÈöêÊÇ£</li>
<li>sessionÂ≠òÂÇ®ÁöÑÊï∞ÊçÆÂ§ßÂ∞èÂèócookieÈôêÂà∂</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>version 3: Nginx reverse proxy hash: (ÂèçÂêë‰ª£ÁêÜhash‰∏ÄËá¥ÊÄß)</strong></p>
<ul>
<li>ÊÄùË∑ØÔºöÂèçÂêë‰ª£ÁêÜÂ±Ç‰ΩøÁî®Áî®Êà∑ipÊù•ÂÅöhashÔºå‰ª•‰øùËØÅÂêå‰∏Ä‰∏™ipÁöÑËØ∑Ê±ÇËêΩÂú®Âêå‰∏Ä‰∏™web-server‰∏ä</li>
<li><p>‰ºòÁÇπÔºö</p>
<ul>
<li>Âè™ÈúÄË¶ÅÊîπnginxÈÖçÁΩÆÔºå‰∏çÈúÄË¶Å‰øÆÊîπÂ∫îÁî®‰ª£Á†Å</li>
<li>Ë¥üËΩΩÂùáË°°ÔºåÂè™Ë¶ÅhashÂ±ûÊÄßÊòØÂùáÂåÄÁöÑÔºåÂ§öÂè∞web-serverÁöÑË¥üËΩΩÊòØÂùáË°°ÁöÑ</li>
<li>ÂèØ‰ª•ÊîØÊåÅweb-serverÊ∞¥Âπ≥Êâ©Â±ïÔºàsessionÂêåÊ≠•Ê≥ïÊòØ‰∏çË°åÁöÑÔºåÂèóÂÜÖÂ≠òÈôêÂà∂Ôºâ</li>
</ul>
</li>
<li><p>‰∏çË∂≥Ôºö</p>
<ul>
<li>Â¶ÇÊûúweb-serverÈáçÂêØÔºå‰∏ÄÈÉ®ÂàÜsession‰ºö‰∏¢Â§±Ôºå‰∫ßÁîü‰∏öÂä°ÂΩ±ÂìçÔºå‰æãÂ¶ÇÈÉ®ÂàÜÁî®Êà∑ÈáçÊñ∞ÁôªÂΩï</li>
<li>Â¶ÇÊûúweb-serverÊ∞¥Âπ≥Êâ©Â±ïÔºårehashÂêésessionÈáçÊñ∞ÂàÜÂ∏ÉÔºå‰πü‰ºöÊúâ‰∏ÄÈÉ®ÂàÜÁî®Êà∑Ë∑ØÁî±‰∏çÂà∞Ê≠£Á°ÆÁöÑsession</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>version 4: Database layer for whole session(ÂêéÁ´ØÁªü‰∏ÄÈõÜ‰∏≠Â≠òÂÇ®)</strong></p>
<ul>
<li>ÊÄùË∑ØÔºöÂ∞ÜsessionÂ≠òÂÇ®Âú®web-serverÂêéÁ´ØÁöÑÂ≠òÂÇ®Â±ÇÔºåÊï∞ÊçÆÂ∫ìÊàñËÄÖÁºìÂ≠ò</li>
<li><p>‰ºòÁÇπÔºö</p>
<ul>
<li>Ê≤°ÊúâÂÆâÂÖ®ÈöêÊÇ£</li>
<li>ÂèØ‰ª•Ê∞¥Âπ≥Êâ©Â±ïÔºåÊï∞ÊçÆÂ∫ì/ÁºìÂ≠òÊ∞¥Âπ≥ÂàáÂàÜÂç≥ÂèØ</li>
<li>web-serverÈáçÂêØÊàñËÄÖÊâ©ÂÆπÈÉΩ‰∏ç‰ºöÊúâsession‰∏¢Â§±</li>
</ul>
</li>
<li><p>‰∏çË∂≥Ôºö</p>
<ul>
<li>Â¢ûÂä†‰∫Ü‰∏ÄÊ¨°ÁΩëÁªúË∞ÉÁî®ÔºåÂπ∂‰∏îÈúÄË¶Å‰øÆÊîπÂ∫îÁî®‰ª£Á†Å</li>
</ul>
<p>sessionËØªÂèñÁöÑÈ¢ëÁéá‰ºöÂæàÈ´òÔºåÊï∞ÊçÆÂ∫ìÂéãÂäõ‰ºöÊØîËæÉÂ§ß„ÄÇÂ¶ÇÊûúÊúâsessionÈ´òÂèØÁî®ÈúÄÊ±ÇÔºåcacheÂèØ‰ª•ÂÅöÈ´òÂèØÁî®Ôºå‰ΩÜÂ§ßÈÉ®ÂàÜÊÉÖÂÜµ‰∏ãsessionÂèØ‰ª•‰∏¢Â§±Ôºå‰∏ÄËà¨‰πü‰∏çÈúÄË¶ÅËÄÉËôëÈ´òÂèØÁî®„ÄÇ</p>
</li>
</ul>
</li>
<li><p><strong>Summary: for improved <code>session&amp;cookie</code> approach</strong></p>
<p>  ÂØπ‰∫éÊñπÊ°à3ÂíåÊñπÊ°à4ÔºåÊé®ËçêÂêéËÄÖÔºö</p>
<ul>
<li>webÂ±Ç„ÄÅserviceÂ±ÇÊó†Áä∂ÊÄÅÊòØÂ§ßËßÑÊ®°ÂàÜÂ∏ÉÂºèÁ≥ªÁªüËÆæËÆ°ÂéüÂàô‰πã‰∏ÄÔºåsessionÂ±û‰∫éÁä∂ÊÄÅÔºå‰∏çÂÆúÊîæÂú®webÂ±Ç</li>
<li>ËÆ©‰∏ì‰∏öÁöÑËΩØ‰ª∂ÂÅö‰∏ì‰∏öÁöÑ‰∫ãÊÉÖÔºåweb-serverÂ≠òsessionÔºüËøòÊòØËÆ©cacheÂéªÂÅöËøôÊ†∑ÁöÑ‰∫ãÊÉÖÂêß„ÄÇ</li>
</ul>
</li>
</ul>
<h2 id="III-JWT-authetication"><a href="#III-JWT-authetication" class="headerlink" title="III. JWT authetication"></a>III. JWT authetication</h2><blockquote>
<p>Â•ΩÊñá: <a href="https://www.ctolib.com/flylib-fly-auth.html" target="_blank" rel="noopener">https://www.ctolib.com/flylib-fly-auth.html</a></p>
</blockquote>
<blockquote>
<ol>
<li>server‰∏çÂÜç‰Ωú‰∏∫<code>ÊïèÊÑüÊï∞ÊçÆÂ∫ì</code>ÁöÑÂÖ≥Âç°Ôºå‰∏∫clientÊúçÂä°Ôºõ</li>
<li>browerËá™Â∑±<code>ÊØèÊ¨°</code>ÈÉΩÊê∫Â∏¶<code>authentication token</code>ËøõË°årequest</li>
</ol>
</blockquote>
<p><strong>0.„ÄêJWTÊú¨Ë¥®Ôºö„Äë</strong> </p>
<ul>
<li><strong>Áõ∏ÂΩì‰∫éÊØèÊ¨°browser requestÔºåÈÉΩË¶ÅÊ±ÇÁî®Êà∑ËæìÂÖ•<code>account &amp; password</code></strong>   </li>
<li><strong>Âç≥ÔºöÁ¨¨‰∏ÄÊ¨°Áî®Êà∑ÁôªÈôÜÊàêÂäüÂêéÔºåserverÊ†πÊçÆÂÖ∂‚ÄúÁî®Êà∑ÂêçÂØÜÁ†Å‚ÄùÁîüÊàêÂîØ‰∏Ä‚Äú‰ª§Áâåtoken‚ÄùÔºåÂæÄÂêéËØ•Áî®Êà∑Âè™Ë¶ÅÂ∏¶‰∏äËØ•tokenËøõË°åËÆøÈóÆÂ∞±ÂèØ‰ª•</strong>   </li>
<li><strong>Áõ∏ÂêåÁÇπÔºö<code>session</code>ÊñπÊ≥ïÁ±ª‰ººÔºå<code>cookie</code>‰∏≠ÁöÑ<code>sessionID</code>‰πüÁõ∏ÂΩì‰∫é‚Äú‰ª§Áâåtoken‚ÄùÔºåÊØèÊ¨°ËØ∑Ê±ÇÈÉΩÊê∫Â∏¶‰∏ä</strong></li>
<li><strong>‰∏çÂêåÁÇπÔºö</strong><ul>
<li><strong><code>JWT</code>ÊñπÊ≥ïÁöÑtokenÁîüÊàê‰æùËµñ‰∫é<code>Áî®Êà∑ÂêçÂØÜÁ†Å</code>‰∏é<code>SHA256</code>Ôºå‰∏çÂèóserverÁéØÂ¢ÉÂΩ±Âìç</strong></li>
<li><strong><code>session</code>ÊñπÊ≥ïÁöÑ<code>sessionID</code>ÁîüÊàê‰æùËµñ‰∫é<code>server session context</code>ÔºåÊØè‰∏™serverÁîüÊàêÁöÑ<code>sessionID</code>‰∏ç‰∏ÄËá¥ÔºåÊó†Ê≥ïÈÄÇÁî®‰∫édistributed system</strong></li>
</ul>
</li>
</ul>
<p><strong>1. Problems with <code>session</code> approach</strong> </p>
<ul>
<li>memcacheÊàñËÄÖredisÁöÑ<strong>Á®≥ÂÆöÊÄß</strong>‰ºöÂΩ±Âìç‰∏öÂä°Á≥ªÁªüÁöÑÂèØÁî®ÊÄß</li>
<li><strong>ÂæÆÊúçÂä°ÁöÑÂπ∂ÂèëËÉΩÂäõ</strong>ÂèóÈôê‰∫émemcacheÊàñËÄÖredisÁöÑÂπ∂ÂèëËÉΩÂäõ</li>
<li>Áî±Ê≠§ÂèØËßÅÔºåÈõÜ‰∏≠ÁöÑsessionÁÆ°ÁêÜ‰πü‰∏çÊòØÊúÄ‰ºòÁöÑÈÄâÊã©„ÄÇ</li>
<li>Êàë‰ª¨‰∏çÂÜçÂÖ≥Ê≥®sessionÊú¨ ÔºåÊääsessionÁöÑÈóÆÈ¢òÊäõÂºÄÔºåËÆ©Êàë‰ª¨ÁöÑÊúçÂä°ÈÉΩÊòØÊó†Áä∂ÊÄÅÁöÑ„ÄÇ</li>
<li>‰∫éÊòØÊàë‰ª¨ÊääÁõÆÂÖâËΩ¨ÂêëWEB TOKEN: JWTÔºàJson web token Ôºâ    </li>
</ul>
<p><strong>2. Benefits using JWT</strong></p>
<blockquote>
<p>„ÄêÂ•ΩÊñá„Äë<a href="https://www.ctolib.com/topics-113075.html" target="_blank" rel="noopener">https://www.ctolib.com/topics-113075.html</a></p>
</blockquote>
<ul>
<li>Ëß£ÂÜ≥Ë∑®ÂüüÈóÆÈ¢òÔºöËøôÁßçÂü∫‰∫éTokenÁöÑËÆøÈóÆÁ≠ñÁï•ÂèØ‰ª•ÂÖãÊúçcookiesÁöÑË∑®ÂüüÈóÆÈ¢ò„ÄÇ</li>
<li>ÊúçÂä°Á´ØÊó†Áä∂ÊÄÅÂèØ‰ª•Ê®™ÂêëÊâ©Â±ïÔºåTokenÂèØÂÆåÊàêËÆ§ËØÅÔºåÊó†ÈúÄÂ≠òÂÇ®Session„ÄÇ</li>
<li>Á≥ªÁªüËß£ËÄ¶ÔºåTokenÊê∫Â∏¶ÊâÄÊúâÁöÑÁî®Êà∑‰ø°ÊÅØÔºåÊó†ÈúÄÁªëÂÆö‰∏Ä‰∏™ÁâπÂÆöÁöÑËÆ§ËØÅÊñπÊ°àÔºåÂè™ÈúÄË¶ÅÁü•ÈÅìÂä†ÂØÜÁöÑÊñπÊ≥ïÂíåÂØÜÈí•Â∞±ÂèØ‰ª•ËøõË°åÂä†ÂØÜËß£ÂØÜÔºåÊúâÂà©‰∫éËß£ËÄ¶„ÄÇ</li>
<li>Èò≤Ê≠¢Ë∑®Á´ôÁÇπËÑöÊú¨ÊîªÂáªÔºåÊ≤°ÊúâcookieÊäÄÊúØÔºåÊó†ÈúÄËÄÉËôëË∑®Á´ôËØ∑Ê±ÇÁöÑÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ</li>
</ul>
<p><strong>3. Principle of JWT ÂéüÁêÜÁÆÄ‰ªã</strong></p>
<p>JSON Web TokensÁöÑÊ†ºÂºèÁªÑÊàêÔºåjwtÊòØ‰∏ÄÊÆµË¢´base64ÁºñÁ†ÅËøáÁöÑÂ≠óÁ¨¶Â∫èÂàóÔºåÁî®ÁÇπÂè∑ÂàÜÈöîÔºå‰∏ÄÂÖ±Áî±‰∏âÈÉ®ÂàÜÁªÑÊàêÔºåÂ§¥ÈÉ®<code>header</code>ÔºåÊ∂àÊÅØ‰Ωì<code>playload</code>ÂíåÁ≠æÂêç<code>sign</code></p>
<ul>
<li><p>Â§¥ÈÉ®<code>Header</code>ÊòØjsonÊ†ºÂºèÔºö</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"typ"</span>:<span class="string">"JWT"</span>,            <span class="comment">// ËØ•Á±ªÂûãÊòØJWTÁ±ªÂûã</span></span><br><span class="line">    <span class="string">"alg"</span>:<span class="string">"HS256"</span>,          <span class="comment">// Âä†ÂØÜÊñπÂºèÂ£∞ÊòéÊòØHS256</span></span><br><span class="line">    <span class="string">"exp"</span>:<span class="number">1491066992916</span>     <span class="comment">// expire ‰ª£Ë°®ËøáÊúüÊó∂Èó¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ê∂àÊÅØ‰Ωì<code>Playload</code>jsonÊ†ºÂºèÔºö</p>
<p>  Ê∂àÊÅØ‰ΩìÁöÑÂÖ∑‰ΩìÂ≠óÊÆµÂèØÊ†πÊçÆ‰∏öÂä°ÈúÄË¶ÅËá™Ë°åÂÆö‰πâÂíåÊ∑ªÂä†ÔºåÂè™ÈúÄÂú®Ëß£ÂØÜÁöÑÊó∂ÂÄôÊ≥®ÊÑèÊãøÂ≠óÊÆµÁöÑkeyÂÄºËé∑Âèñvalue„ÄÇ</p>
<pre><code class="javascript">{
    <span class="string">"userid"</span>:<span class="string">"123456"</span>,
    <span class="string">"iss"</span>:<span class="string">"companyName"</span> 
}
</code></pre>
</li>
<li><p>Á≠æÂêç<code>sign</code>ÁöÑÁîüÊàê</p>
<ul>
<li>Á≠æÂêçÁöÑÁîüÊàêÊòØÊääheaderÂíåplayloadÂàÜÂà´‰ΩøÁî®base64urlÁºñÁ†Å,Êé•ÁùÄÁî®‚Äô.‚ÄòÊää‰∏§‰∏™ÁºñÁ†ÅÂêéÁöÑÂ≠óÁ¨¶‰∏≤ËøûÊé•Ëµ∑Êù•</li>
<li>ÂÜçÊääËøôÊãºÊé•Ëµ∑Êù•ÁöÑÂ≠óÁ¨¶‰∏≤ÈÖçÂêàÂØÜÈí•ËøõË°åHMAC SHA-256ÁÆóÊ≥ïÂä†ÂØÜ</li>
<li>ÁÑ∂ÂêéÂÜçÊ¨°‰ΩøÁî®base64urlÁºñÁ†ÅÔºåËøôÂ∞±ÊãøÂà∞‰∫ÜÁ≠æÂêçsign. </li>
<li>ÊúÄÂêéÊääheaderÂíåplayloadÂíåsignÁî®‚Äô.‚Äò ËøûÊé•Ëµ∑Êù•Â∞±ÁîüÊàê‰∫ÜÊï¥‰∏™JWT„ÄÇ</li>
</ul>
</li>
</ul>
<p><strong>4. Principle of JWT Checking Ê†°È™åÁÆÄ‰ªã</strong></p>
<blockquote>
<p>JWT‰∏çËÉΩ‰øùÊä§Êï∞ÊçÆÔºåÂè™ËÉΩÈ™åËØÅÊï∞ÊçÆÊòØÂê¶ÊòØÂéüÂßãÊï∞ÊçÆÔºåÊòØÂê¶Ë¢´ÁØ°ÊîπËøá</p>
</blockquote>
<p>JWTÊòØÁî±<code>header.playload.sign</code>ËøûÊé•ÁªÑÊàêÔºåÂè™ÊúâsignÊòØÁî®ÂØÜÈí•Âä†ÂØÜÁöÑÔºåËÄåÊâÄÊúâÁöÑ‰ø°ÊÅØÈÉΩÂú®headerÂíåplayload‰∏≠ÂèØ‰ª•Áõ¥Êé•Ëé∑ÂèñÔºåsignÁöÑ‰ΩúÁî®Âè™ÊòØÊ†°È™åheaderÂíåplayloadÁöÑ‰ø°ÊÅØÊòØÂê¶Ë¢´ÁØ°ÊîπËøá</p>
<ol>
<li><p>Âä†ÂØÜÔºöÊØîÂ¶ÇË¶ÅÂä†ÂØÜÈ™åËØÅÁöÑÊòØuseridÂ≠óÊÆµÔºö</p>
<ul>
<li>È¶ñÂÖàÊåâÂâçÈù¢ÁöÑÊ†ºÂºèÁªÑË£ÖjsonÊ∂àÊÅØÂ§¥headerÂíåÊ∂àÊÅØ‰ΩìplayloadÔºåÊåâheader.playloadÁªÑÊàêÂ≠óÁ¨¶‰∏≤Ôºõ</li>
<li>ÂÜçÊ†πÊçÆÂØÜÈí•ÂíåHS256Âä†ÂØÜheader.playloadÂæóÂà∞signÁ≠æÂêçÔºõ</li>
<li>ÊúÄÂêéÂæóÂà∞jwtToken‰∏∫header.playload.signÔºåÂú®httpËØ∑Ê±Ç‰∏≠ÁöÑurlÂ∏¶‰∏äÂèÇÊï∞ÊÉ≥ÂêéÁ´ØÊúçÂä°ËØ∑Ê±ÇËÆ§ËØÅ</li>
</ul>
</li>
<li><p>Ëß£ÂØÜÔºöÂêéÁ´ØÊúçÂä°Ê†°È™åjwtTokenÊòØÂê¶ÊúâÊùÉËÆøÈóÆÊé•Âè£ÊúçÂä°ÔºåËøõË°åËß£ÂØÜËÆ§ËØÅÔºåÂ¶ÇÊ†°È™åËÆøÈóÆËÄÖÁöÑuseridÔºö</p>
<ul>
<li>Áî®Â∞ÜÂ≠óÁ¨¶‰∏≤Êåâ<code>.</code>ÂàáÂàÜ‰∏âÊÆµÂ≠óÁ¨¶‰∏≤ÔºåÂàÜÂà´ÂæóÂà∞headerÂíåplayloadÂíåsign„ÄÇ</li>
<li>ÁÑ∂ÂêéÂ∞Üheader.playloadÊãºË£ÖÁî®ÂØÜÈí•ÂíåSHA-256ÁÆóÊ≥ïËøõË°åÂä†ÂØÜÁÑ∂ÂêéÂæóÂà∞Êñ∞ÁöÑÂ≠óÁ¨¶‰∏≤ÂíåsignËøõË°åÊØîÂØπÔºå</li>
<li>Â¶ÇÊûú‰∏ÄÊ†∑Â∞±‰ª£Ë°®Êï∞ÊçÆÊ≤°ÊúâË¢´ÁØ°ÊîπÔºåÁÑ∂Âêé‰ªéÂ§¥ÈÉ®ÂèñÂá∫expÂØπÂ≠òÊ¥ªÊúüËøõË°åÂà§Êñ≠</li>
<li>Â¶ÇÊûúË∂ÖËøá‰∫ÜÂ≠òÊ¥ªÊúüÂ∞±ËøîÂõûÁ©∫Â≠óÁ¨¶‰∏≤ÔºåÂ¶ÇÊûúÂú®Â≠òÊ¥ªÊúüÂÜÖËøîÂõûuseridÁöÑÂÄº</li>
</ul>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mingkai.jpg"
                alt="Mingkai Cao" />
            
              <p class="site-author-name" itemprop="name">Mingkai Cao</p>
              <p class="site-description motion-element" itemprop="description">All-trade Jack, loves full-stack</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">79</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">131</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/caomingkai" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:mingkaic@usc.edu" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate"> 
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mingkai Cao</span>

  

  
</div>


  



  <div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.6</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  


<style>
    #comments .vempty{
        display: none;
    }
</style>

</body>
</html>
